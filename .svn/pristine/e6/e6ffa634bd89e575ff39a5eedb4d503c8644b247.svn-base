/**
* upload
* @version 0.6.7
* @namespace FOCUS.widget
* @author lvxiang
*/
void function(g,k,l){g.FOCUS||(g.FOCUS={});FOCUS.namespace=function(){for(var c=[].slice.call(arguments),e,b,a,d=[];c.length;){e=c.shift().split(/\./);for(a=g;e.length;)b=e.shift(),a[b]||(a[b]={}),a=a[b];d.push(a)}return 1<d.length?d:d[0]};FOCUS.BASEPATH=g.FOCUS_BASEPATH||function(c){for(var e=g.location,b=/^(\w+\:\/{2,3}.+?)\//.exec(e.href)[1],a=/(^\/?|.*?\/)FOCUS\/[^?#]+\.js(?:[?#].*)?$/,d=/^\w+\:\/\//,m=/^\//,f=/^.*\//,h,s,p=0,k=c.length;p<k;p++)if(s=c[p].src,d.test(s)||(s=m.test(s)?b+s:f.exec(e.href)[0]+
s),s=a.exec(s)){h=s[1];break}h?(h=h.replace(RegExp(e.protocol+"\\/\\/"+e.host,"i"),""),h=e.protocol+"//"+e.host+h+"FOCUS/"):h=f.exec(e.href)[0];return h}(k.getElementsByTagName("script"))}.call(this,this,this.document);
void function(g,k,l){FOCUS.namespace("FOCUS.util");FOCUS.util.type=function(b){var a,d=/\{\s*\[native\s*code\]\s*\}/i;null===b?a="null":"undefined"===typeof b?a="undefined":(a=Object.prototype.toString.call(b).match(/\w+/g)[1].toLowerCase(),"object"===a&&d.test(b+"")&&(a="function"));return a};FOCUS.util.trim=function(b){return(b+"").replace(/^[\s\u00A0]+|[\s\u00A0]+$/g,"")};FOCUS.util.JSON=function(b){var a={};a.stringify=b?b.stringify:function(){return""};a.parse=function(d){var a;if("string"===
FOCUS.util.type(d))try{a=(new Function("return "+d))()}catch(b){a={}}else a=d;return a};return a}.call(this,g.JSON);FOCUS.util.browser=function(b){var a=/chrome\/(\d+\.\d+)/,d=/safari\/(\d+\.\d+)/,m=/version\/(\d+\.\d+)/,f={},h;if(h=/msie\s*(\d+\.\d+)/.exec(b))return f.msie=!0,f.version=h[1],f;if(h=/firefox\/(\d+\.\d+)/.exec(b))return f.mozilla=f.firefox=!0,f.version=h[1],f;if(h=/webkit\/(\d+\.\d+)/.exec(b)){f.webkit=!0;f.version=h[1];if(g.chrome)return f.chrome=!0,f.version=a.exec(b)[1],f;if(h=d.exec(b))f.safari=
!0,f.version=[1];return f}if((h=/opera/.exec(b))&&g.opera)f.opera=!0,f.version=m.exec(b)[1];return f}.call(this,g.navigator.userAgent.toLowerCase());FOCUS.util.flash=function(b,a){var d={has:!1,version:0};if(a.length&&a["Shockwave Flash"])a["Shockwave Flash"].description&&!("undefined"!==typeof b.mimeTypes&&b.mimeTypes["application/x-shockwave-flash"]&&!b.mimeTypes["application/x-shockwave-flash"].enabledPlugin)&&(d={has:!0,version:/\d+\.\d+/.exec(a["Shockwave Flash"].description)[0]});else if(g.ActiveXObject){var m,
f=/\d+/g;try{m=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(h){}m&&(f.exec(""),d={has:!0,version:m.GetVariable("$version").match(f).join(".")})}return d}.call(this,g.navigator,g.navigator.plugins);FOCUS.util.extend=function(){var b=arguments.callee,a,d;"object"!==FOCUS.util.type(arguments[0])?(a=1,d=!!arguments[0]):(a=0,d=!1);var m=arguments[a]||{};a=[].slice.call(arguments,a+1);for(var f,h;a.length;)if(f=a.shift(),"object"===FOCUS.util.type(f)){var c,e;for(e in f)if(c=f[e],"object"===
FOCUS.util.type(c))if(c==g||c==k||"childNodes"in c&&"nextSibling"in c&&"nodeType"in c){if(d||!(e in m))m[m]=c}else{h=FOCUS.util.type(m[e]);if(!(e in m)||"undefined"===h||"null"===h)m[e]={};"object"===FOCUS.util.type(m[e])&&b(d,m[e],c)}else if(d||!(e in m))m[e]=c}return m};FOCUS.util.console=function(b){var a=!1,d=function(){},c={ON:!0,OFF:!1},d={SWITCH:c,turn:function(d){a=c[d?"ON":"OFF"]},log:d,info:d,warn:d,error:d,debug:d};if(!b)return d;b.debug||(b.debug=b.log);b.error||(b.error=b.warn);return FOCUS.util.extend(!0,
d,{log:function(d){a===c.ON&&b.log(d)},info:function(d){a===c.ON&&b.info(d)},warn:function(d){a===c.ON&&b.warn(d)},error:function(d){a===c.ON&&b.error(d)},debug:function(d){a===c.ON&&b.debug(d)}})}.call(g,g.console);FOCUS.util.indexOf=function(b,a){if(b.indexOf)return b.indexOf(a);for(var d=-1,c=0,f=b.length;c<f;c++)if(b[c]===a){d=c;break}return d};FOCUS.util.unique=function(b){for(var a=[],d=0,c=b.length;d<c;d++)-1===FOCUS.util.indexOf(a,b[d])&&a.push(b[d]);return a};FOCUS.util.random=function(){var b=
{};return function(a,d,c){a=a||0;d="number"===FOCUS.util.type(d)&&!isNaN(d)?d===a?d+10:d:a+10;var f=a+"_"+d;b[f]||(b[f]=[]);b[f].length===d-a&&(b[f]=[],"function"===FOCUS.util.type(c)&&c.call(this));for(var h;;)if(h=a+~~(Math.random()*(d-a)),-1===FOCUS.util.indexOf(b[f],h)){b[f].push(h);break}return h}}.call(this);FOCUS.util.createElement=function(){return function(b){var a={};FOCUS.util.extend(!0,a,b);var d;b=FOCUS.util.extend(!0,{},a);var c=["<",b.el],f=b.el;delete b.el;for(d in b)c.push(" ",d,
'="',b[d],'"');c.push(-1===",meta,base,link,img,input,br,hr,area,sharp,".indexOf(","+f+",")?"></"+f+">":" />");d=c.join("");var h;b=!1;try{h=k.createElement(d)}catch(e){b=!0,h=k.createElement(a.el),delete a.el}if(b)for(var p in a)h[p]=a[p];"input"===h.tagName.toLowerCase()&&(h.type=a.type?a.type:"text");return h}}.call(this);FOCUS.util.event=function(){var b=function(d){return d?function(d,a,b){d.addEventListener(a,b,!1)}:function(d,a,b){d.attachEvent("on"+a,b)}}.call(this,!!g.addEventListener);(function(d){return d?
function(d,a,b){d.removeEventListener(a,b)}:function(d,a,b){d.detachEvent("on"+a,b)}}).call(this,!!g.removeEventListener);var a="FOCUS_EVENTS_"+(new Date).valueOf(),d=function(d,a){for(var b=0,c=a.length;b<c;b++)a[b].handler.apply(this,[d].concat(a[b].params))};return{bind:function(c,f,h){c[a]||(c[a]={});var e=c[a];e[f]||(e[f]=[],b(c,f,function(a){a=a||g.event;d.call(c,a,e[f])}));e[f].push({handler:h,params:[].slice.call(arguments,3)})},remove:function(d,b,c){if(d[a]&&!(d[a]&&!d[a][b]||d[a]&&!d[a][b].length))if(d=
d[a][b],c){b=-1;for(var e=0,g=d.length;e<g;e++)if(d[e].handler===c){b=e;break}c=b;-1!=c&&d.splice(c,1)}}}}.call(this);FOCUS.util.feature_upload=function(b){var a=function(){var d=FOCUS.util.flash,a=d.has;if(d&&d.has&&b.oscpu&&FOCUS.util.browser.firefox&&4<=FOCUS.util.browser.version&&13>=FOCUS.util.browser.version){var c=/windows\s*nt\s*([\d\.]+)/i.exec(b.oscpu);if(c&&(/^6\.0/.test(c[1])||/^6\.1/.test(c[1]))&&/^11\.3/.test(d.version))a=!1}return a}.call(this),d=function(){if(FOCUS.util.browser.firefox&&
3.6>FOCUS.util.browser.version)return!1;var d={},a=k.createElement("input");a.type="file";a.style.cssText="position:absolute; top:-999px; height:-999px;";k.body.appendChild(a);d.file=!!a.files;d.multiple="multiple"in a&&!(FOCUS.util.browser.apple&&6>FOCUS.util.browser.version);k.body.removeChild(a);delete a;if(!g.XMLHttpRequest)return!1;a=new XMLHttpRequest;d.upload=!!a.upload;d.sendAsBinary=!!a.sendAsBinary;d.FormData=!!g.FormData&&!g.FormData.customized;delete a;return d}.call(this),c=function(){var d=
{};d.sameDomain=k.domain===(g.location.host||g.location.hostname);return d}.call(this);return{html5:d,flash:a,iframe:c}}.call(this,g.navigator);FOCUS.util.sizeConvert=function(){var b={KB:1024,MB:1048576,GB:1073741824},a=function(d,a){this.size=d;this.unit=a};a.prototype={toString:function(){return this.size+" "+this.unit},valueOf:function(){return this.size}};var d=/^((?:\d+)(?:\.\d+)?)\s*([A-Za-z]*)$/g,c=/([A-Za-z]+)$/;return{unit2Bytes:function(a){var h=0;c.test(a)?(d.exec(""),(a=d.exec(a))&&(h=
(parseFloat(a[1])||0)*(a[2]?b[a[2].toUpperCase()]:1024))):h=parseInt(a)||0;return h||0},bytes2Unit:function(d,c){var e=0,m=["GB","MB","KB"];c=c||"";if(!c)for(var g=0;g<m.length;g++)if(d>b[m[g]]){c=m[g];break}c&&(e=d/b[c]);return e=new a(e||0,c)}}}.call(this);!g.FormData&&FOCUS.util.feature_upload.html5.sendAsBinary&&(g.FormData=function(b){this.charset=b||"UTF-8";this.reset()},g.FormData.prototype={append:function(b,a){var d="",c=this.EOL,f="--"+this.boundary,e=FOCUS.util.type(a);"object"===e&&(a=
JSON.stringify(a),e="string");d=d+(f+c)+"Content-Disposition: form-data; ";"file"===e?(d+='name="'+this.encode(b)+'"; ',d+='filename="'+this.encode(a.filename||a.name)+'"'+c,d+="Content-Type: "+(a.type?a.type:"application/octet-stream")+c+c,d+=a.getAsBinary()+c):(d+='name="'+this.encode(b)+'"'+c+c,d+=this.encode(a)+c);this.data+=d},getData:function(){return this.data+"--"+this.boundary+"--"+this.EOL},valueOf:function(){return this.getData()},toString:function(){return this.getData()},reset:function(){this.data=
"";this.boundary="---------------------------71"+(new Date).valueOf().toString(16).replace(/^0x/,"");this.EOL="\r\n"},encode:function(b){return FOCUS.util.transformCharset?FOCUS.util.transformCharset(b,this.charset):encodeURI(b)}},g.FormData.customized=!0);var c={"*/*":"*.*","image/*":"*.jpg; *.jpeg; *.jpe; *.png; *.gif","image/png":"*.png","image/jpeg":"*.jpg; *.jpeg; *.jpe","image/jpg":"*.jpg; *.jpeg; *.jpe","image/gif":"*.gif","application/gzip":"*.gz","application/zip":"*.zip","application/vnd.ms-excel":"*.xls",
"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"*.xlsx","application/msword":"*.doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"*.docx","application/vnd.ms-powerpoint":"*.ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":"*.pptx","application/mshelp":"*.hlp; *.chm","application/pdf":"*.pdf","application/mp3":"*.mp3","text/html":"*.html; *.htm; *.xhtml","text/javascript":"*.js","text/css":"*.css","text/plain":"*.txt",
"default":"*.*"},e=function(b){var a=["image/*","image/jpg","default"],d={},c;for(c in b)-1===FOCUS.util.indexOf(a,c)&&b[c].replace(/[^\;\u0020]+/g,function(a){d[a]=c});return d}(c);FOCUS.util.convert2MimeTypes=function(b){b=b.split(/[\;\,]\s*/);var a=[],d="";if(b.length){for(var c=/^[^\/]+\/[^\/]+$/,f=0;f<b.length;f++)if(c.test(b[f]))a.push(b[f]);else if(b[f]in e&&"*.*"!==b[f])a.push(e[b[f]]);else{d="*/*";break}d||(d=FOCUS.util.unique(a).join(", "))}else d="*/*";return d};FOCUS.util.convertMimeTypes=
function(b){b=b.split(/[\;\,]\s*/);var a=[],d="";if(b.length){for(var e=/^[^\\\/]+\.[^\\\/]+$/,f=0;f<b.length;f++)if(e.test(b[f]))a.push(b[f]);else if(b[f]in c&&"*/*"!==b[f])a.push(c[b[f]]);else{d="*.*";break}d||(d=FOCUS.util.unique(a).join("; "))}else d="*.*";return d};FOCUS.util.mimeValidation=function(b,a){if(-1!==(b+"").indexOf("*/*"))return!0;a+="";"string"===FOCUS.util.type(b)&&(b=b.split(/[\;\,\s]+/));var d=!1,c=/^([^\/]+)\/([^\/]+)$/,e=c.exec(a),h;if(!e)return!1;for(var g=0;g<b.length;g++)if(h=
c.exec(b[g]),b[g]===a||h[1]===e[1]&&("*"===h[2]||h[2]===e[2])){d=!0;break}return d};FOCUS.util.addClass=function(b,a){var d=FOCUS.util.trim(b.className).split(/\s+/);d.push(a);b.className=FOCUS.util.unique(d).join(" ")};FOCUS.util.removeClass=function(b,a){var d=FOCUS.util.unique(FOCUS.util.trim(b.className).split(/\s+/)),c=FOCUS.util.indexOf(d,a);-1!==c&&d.splice(c,1);b.className=d.join(" ")}}.call(this,this,this.document);
void function(g,k,l){FOCUS.namespace("FOCUS.widget");var c=function(){},e=function(){var a=FOCUS.util.feature_upload;return{flash:a.flash,html5:a.html5&&a.html5.upload&&(a.html5.sendAsBinary||a.html5.FormData),iframe:!0}}.call(this);FOCUS.widget.Upload=function(a){this.cfg={priority:FOCUS.widget.Upload.PRIORITY.DEFAULT,events:{ready:c,loadFailed:c,dialogStart:c,dialogComplete:c,queued:c,queueError:c,uploadStart:c,uploadProgress:c,uploadSuccess:c,uploadError:c,uploadComplete:c},button:{text:"Upload"},
multiple:!0,sizeLimit:-1,uploadLimit:-1,queueLimit:-1,fileTypes:FOCUS.widget.Upload.MIME_TYPE.ALL,uploadURL:"",filePostName:"",placeholder:"",debug:!1,plugins:"UploadEvents,AutoDisabled,Ready"};this.set(a);FOCUS.widget.Upload.plugins.UploadEvents&&(this.uploadEvents=new FOCUS.widget.Upload.plugins.UploadEvents(this.cfg.events),this.set({events:this.uploadEvents.events}));this._={};this.init();return this.instance};FOCUS.widget.Upload.prototype={init:function(){for(var a=this,d=this.cfg.priority,c,
f=0;f<d.length;f++)if(e[d[f]]){c=d[f];break}d={html5:"Upload_HTML5",flash:"Upload_Flash",iframe:"Upload_Iframe"};if(c){if(c===FOCUS.widget.Upload.MODE.FLASH){b();for(var h in this.cfg.events)this.cfg.events[h]=function(d,a){var b=FOCUS.widget.Upload.File;return function(a){a&&a.id?d.apply(this,[new b(a)].concat([].slice.call(arguments,1))):d.apply(this,[].slice.call(arguments,0))}}.call(this,this.cfg.events[h],h);this.cfg.fileTypes=FOCUS.util.convertMimeTypes(this.cfg.fileTypes);this.cfg.placeholder=
this.cfg.placeholder.replace(/^#/,"");this.cfg.events.ready=function(d){return function(){setTimeout(function(){d.call(a.instance,c)},25)}}(this.cfg.events.ready)}else this.cfg.fileTypes=FOCUS.util.convert2MimeTypes(this.cfg.fileTypes);this.instance=new FOCUS.widget[d[c]](this.cfg);c!==FOCUS.widget.Upload.MODE.FLASH&&setTimeout(function(){a.cfg.events.ready.call(a.instance,c)},25);h=FOCUS.widget.Upload.plugins;h.UploadEvents&&(this.uploadEvents.bindThisObj(this.instance),"on,one,off,fire".replace(/(\w+)/g,
function(d){a.instance[d]=function(){a.uploadEvents[d].apply(a.uploadEvents,arguments);return a.instance}}));for(var g in h)g.replace(/([\$\^\[\]\\/\,\?\:\|\{\}\!\(\)\*\-\+])/g,"\\$1"),"UploadEvents"!==g&&RegExp("(^|,)"+g+"(,|$)").exec(this.cfg.plugins)&&h[g].call(this.instance,this.instance.mode)}else throw"not support this constructor.";},set:function(a){var d=this.cfg.plugins;a.plugins&&"string"===FOCUS.util.type(a.plugins)&&(d+=","+a.plugins,d=FOCUS.util.unique(d.split(/[,;\s]+/)).join(","));
FOCUS.util.extend(!0,this.cfg,a);this.cfg.plugins=d}};var b=function(a){return function(){a.File=function(d){this.data=d;this.id=d.id;this.size=d.size;this.status=d.filestatus;this.suffix=d.type.replace(/^\./,"");this.type=a.MIME_TYPE[this.suffix.toUpperCase()];this.fullname=d.name;d=this.fullname.split(/\./);1<d.length&&d.pop();this.name=d.join(".")}}}.call(this,FOCUS.widget.Upload)}.call(this,this,this.document);
void function(g,k,l){FOCUS.namespace("FOCUS.widget.Upload");var c=FOCUS.widget.Upload;c.MODE={HTML5:"html5",FLASH:"flash",IFRAME:"iframe",DEFAULT:"html5"};c.PRIORITY={DEFAULT:[c.MODE.HTML5,c.MODE.FLASH,c.MODE.IFRAME]};c.MIME_TYPE={ALL:"*/*",IMAGE:"image/*",JPG:"image/jpeg",JPEG:"image/jpeg",PNG:"image/png",GIF:"image/gif",PDF:"application/pdf",DOC:"application/msword",DOCX:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",XLS:"application/vnd.ms-excel",XLSX:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
PPT:"application/vnd.ms-powerpoint",PPTX:"application/vnd.openxmlformats-officedocument.presentationml.presentation",TXT:"text/plain",UNKNOWN:"application/octet-stream"};c.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130,CHAIN_ERROR:-140};c.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,
UPLOAD_STOPPED:-290,RESIZE:-300,TIMEOUT:-310};c.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5,NEW:-6};c.UPLOAD_TYPE={SINGLE:1,MULTI:2};c.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120,JAVASCRIPT:-130,NONE:-130};c.CURSOR={POINTER:-2,DEFAULT:-1};c.CSS={WRAP:"FOCUS_UPLOAD_wrap",SELECTOR:"FOCUS_UPLOAD_selector",FLASH:"FOCUS_UPLOAD_flashWrap",TEXT:"FOCUS_UPLOAD_text",DISABLED:"FOCUS_UPLOAD_wrap_disabled",HOVER:"FOCUS_UPLOAD_wrap_hover"};c.CHARSET={UTF8:"UTF-8",
GBK:"GBK",GB2312:"GB2312",BIG5:"BIG5",DEFAULT:"UTF-8"};c.TURNING={ON:!0,OFF:!1};var e=function(b,a){a=a||{};var d=b.split(/\./);a.suffix=1<d.length?d.pop():"";a.name=d.join(".");return a};c.File=function(b){var a={data:b};a.id="FOCUS_UPLOAD_"+(FOCUS.util.random(0,1E6)+~~((new Date).valueOf()/1E7)).toString(16).toUpperCase();if(b.tagName&&"input"===b.tagName.toLowerCase()&&"file"===b.type){if(b=/[^\/\\]+$/.exec(b.value))a.fullname=b[0],e(a.fullname,a)}else a.size=b.filesize||b.size||0,a.type=b.type||
"",a.fullname=b.filename||b.name||"",e(a.fullname,a);a.type=a.suffix?a.suffix.toUpperCase()in c.MIME_TYPE?c.MIME_TYPE[a.suffix.toUpperCase()]:"":"";a.status=c.FILE_STATUS.NEW;return a}}.call(this,this,this.document);
void function(g,k){FOCUS.namespace("FOCUS.widget");var l=function(){};FOCUS.widget.UploadBase=function(){};FOCUS.widget.UploadBase.prototype={init:l,set:function(c){this.cfg=FOCUS.util.extend(!0,this.cfg,c)},debug:function(c){FOCUS.util.log.turn(!!c)},startUpload:l,getFile:l,cancelUpload:function(c){var e=this.getQueueFile();if(e){e.status=FOCUS.widget.Upload.FILE_STATUS.CANCELLED;if("function"===FOCUS.util.type(c))this.one("uploadError",c);this.cfg.events.uploadError.call(this,e,FOCUS.widget.Upload.UPLOAD_ERROR.FILE_CANCELLED,
"file cancelled.");this.elems.poster&&this.elems.poster.abort()}},stopUpload:function(c){var e=this.getQueueFile();if(e){e.status=FOCUS.widget.Upload.FILE_STATUS.QUEUED;if("function"===FOCUS.util.type(c))this.one("uploadError",c);this.cfg.events.uploadError.call(this,e,FOCUS.widget.Upload.UPLOAD_ERROR.UPLOAD_STOPPED,"upload stopped.");this.elems.poster&&this.elems.poster.abort();this._.queue.unshift(e)}},getQueueFile:function(c){c=c||0;var e=FOCUS.util.type(c),b=this._.queue,a=null;if("number"===
e)c<=b.length-1&&(a=b[c]);else if("string"===e)for(e=0;e<b.length;e++)if(b[e].id===c){a=b[e];break}return a},setPostParam:function(c){this.cfg.postParams||(this.cfg.postParams={});FOCUS.util.extend(!0,this.cfg.postParams,c)},addPostParam:function(c,e){this.cfg.postParams||(this.cfg.postParams={});this.cfg.postParams[c]=e},removePostParam:function(c){!this.cfg.postParams||!c?this.cfg.postParams={}:c in this.cfg.postParams&&delete this.cfg.postParams[c]},setUploadURL:function(c){this.cfg.uploadURL=
c+""},setFilePostName:function(c){this.cfg.filePostName=c+""},setFileTypes:function(c){switch(this.mode){case FOCUS.widget.Upload.MODE.IFRAME:case FOCUS.widget.Upload.MODE.HTML5:c=FOCUS.util.convert2MimeTypes(c);this.elems.selector.accept=c;break;case FOCUS.widget.Upload.MODE.FLASH:c=FOCUS.util.convertMimeTypes(c)}this.cfg.fileTypes=c},setFileSizeLimit:function(c){this.cfg.sizeLimit=c},setFileQueueLimit:function(c){this.cfg.queueLimit=c},__setStyle:function(c,e,b,a){var d=FOCUS.util,m=FOCUS.widget.Upload.CSS;
e.className=m.WRAP;d.browser.firefox&&(b.size=6);b.className=m.SELECTOR;c=e.getElementsByTagName("label");c.length&&e.removeChild(c[0]);c=k.createElement("label");c.className=m.TEXT;c.innerHTML=a;e.insertBefore(c,b);d.event.bind(e,"mouseover",function(a){a.cancelBubble=!0;a.returnValue=!1;d.addClass(e,m.HOVER)});FOCUS.util.event.bind(e,"mouseout",function(a){a.cancelBubble=!0;a.returnValue=!1;d.removeClass(e,m.HOVER)})},__translateStatus:function(c){var e=FOCUS.util.type(c);"string"===e?(c=FOCUS.util.trim(c),
c=c.length?!!FOCUS.widget.Upload.TURNING[c.toUpperCase()]:FOCUS.widget.Upload.TURNING.OFF):c="undefined"===e?!this._.status:!!c;return c},turn:function(c){c=this.__translateStatus(c);var e=FOCUS.util,b=FOCUS.widget.Upload.CSS;c!==this._.status&&(this.elems.selector.disabled=!c,this._.status=c,e[c?"removeClass":"addClass"](this.elems.holder,b.DISABLED))},multiple:function(c){this.elems.selector.multiple=!!c},queue:function(){},dequeue:function(c){if(this.mode===FOCUS.widget.Upload.MODE.IFRAME||this.mode===
FOCUS.widget.Upload.MODE.HTML5)switch(FOCUS.util.type(c)){case "string":for(var e=0;e<this._.queue.length;e++)if(this._.queue[e].id===c){c=e;break}case "number":this._.queue.splice(c,1);break;case "boolean":c?this._.queue.splice(0):this._.queue.splice(0,1)}else if(this.mode===FOCUS.widget.Upload.MODE.FLASH)switch(FOCUS.util.type(c)){case "string":case "number":this.instance.cancelUpload(c,!1);break;case "undefined":c=!1;case "boolean":if(c)for(;c=this.instance.getQueueFile();)this.instance.cancelUpload(c.file_id,
!1);else this.instance.cancelUpload(0,!1)}}}}.call(this,this,this.document);
void function(g,k){var l=FOCUS.namespace("FOCUS.widget.Upload.plugins"),c=function(b,a){this.type=b;this.listeners=[];this._={thisObj:a}};c.prototype={__search:function(b,a){for(var d=-1,c=a||0;c<this.listeners.length;c++)if(this.listeners[c].handle===b){d=c;break}return d},add:function(b,a){var d=b.handles,c=b.thisObj||null,e=b.once||!1;a=[].slice.call(arguments,1);"function"===FOCUS.util.type(d)&&(d=[d]);if("array"===FOCUS.util.type(d))for(var h=0;h<d.length;h++)"function"===FOCUS.util.type(d[h])&&
this.listeners.push({handle:d[h],thisObj:c,once:!!e,args:a})},one:function(b,a){"object"===FOCUS.util.type(b)&&(b.once=!0,this.add(b,[].slice.call(arguments,1)))},remove:function(b){if(b){"function"===FOCUS.util.type(b)&&(b=[b]);for(var a,d=0;d<b.length;d++)"function"===FOCUS.util.type(b[d])&&-1!==(a=this.__search(b[d]))&&this.listeners.splice(a,1)}else this.listeners=[]},exec:function(b){for(var a,d=[],c=0;c<this.listeners.length;c++)a=this.listeners[c],a.once&&d.push(a.handle),a.handle.apply(a.thisObj||
this._.thisObj||this,[].concat.call(a.args,[].slice.call(arguments)));this.remove(d)},bindThisObj:function(b){this._.thisObj=b}};var e=function(b,a){this._={events:{},thisObj:a};this.events={};for(var d in b)this.on(d,b[d]),this.events[d]=function(d){var a=this;return"uploadError"===d?function(b,c,e){switch(c){case FOCUS.widget.Upload.UPLOAD_ERROR.FILE_CANCELLED:a.fire.apply(a,["cancel",b,FOCUS.widget.Upload.UPLOAD_ERROR.FILE_CANCELLED,"file cancelled."]);break;case FOCUS.widget.Upload.UPLOAD_ERROR.UPLOAD_STOPPED:a.fire.apply(a,
["stop",b,FOCUS.widget.Upload.UPLOAD_ERROR.UPLOAD_STOPPED,"upload stopped."]);break;default:a.fire.apply(a,[d].concat([].slice.call(arguments)))}}:function(){a.fire.apply(a,[d].concat([].slice.call(arguments)))}}.call(this,d)};e.prototype={__initEvent:function(b,a,d){b in this._.events||(this._.events[b]=new c(b,this._.thisObj));return{handles:a,thisObj:d}},on:function(b,a,d,c){var e=this.__initEvent(b,a,d);this._.events[b].add.apply(this._.events[b],[e].concat([].slice.call(arguments,3)))},off:function(b,
a){b in this._.events&&this._.events[b].remove(a)},one:function(b,a,d,c){var e=this.__initEvent(b,a,d);this._.events[b].one.apply(this._.events[b],[e].concat([].slice.call(arguments,3)))},fire:function(b,a){b in this._.events&&this._.events[b].exec.apply(this._.events[b],[].slice.call(arguments,1))},bindThisObj:function(b){this._.thisObj=b;for(var a in this._.events)this._.events[a].bindThisObj(b)}};l.UploadEvents=e}.call(this,window,window.document);
void function(g){FOCUS.namespace("FOCUS.widget.Upload.plugins").AutoDisabled=function(g){this.on("uploadStart",function(){this.turn("off")}).on("uploadComplete",function(){this.turn("on")})}}.call(this);void function(){var g=FOCUS.util;FOCUS.widget.Upload.plugins.Ready=function(k){var l=!1,c=this,e=[],b=function(){for(;e.length;)e.shift().call(c,k)};this.on("ready",function(){this.isReady=l=!0;b()});this.ready=function(a){"function"===g.type(a)&&e.push(a);l&&b()}}}.call(this);
void function(g,k,l){g=FOCUS.namespace("FOCUS.widget.io.iframe");var c=FOCUS.util.createElement;k=function(){this.elems={}};k.prototype={_:{text:function(e,b){return c({el:"textarea",name:e,value:b+""})},radio:function(e,b,a){return c({el:"input",type:"radio",name:e,value:b,checked:!!a})},checkbox:function(e,b,a){return c({el:"input",type:"checkbox",name:e,value:b,checked:!!a})},file:function(e,b){if(e)return b&&b.name&&(e.name=b.name),e;var a={el:"input",type:"file"};FOCUS.util.extend(!0,a,b);return c(a)},
clone:function(c){return c.cloneNode(!0)}},append:function(c,b){var a=FOCUS.util.type(b),d;"string"!==a&&"file"===b.type?d=this._.file(b,{name:c}):"string"===a&&(d=this._.text(c,b+""));this.elems[c]=d}};g.IO_FormData=k}.call(this,window,document);
void function(g,k,l){l=FOCUS.namespace("FOCUS.widget.io.iframe");var c=function(){},e=FOCUS.util.createElement,b=function(a){this.cfg={events:{load:c,error:c},timeout:1E5,charset:"UTF-8"};FOCUS.util.extend(!0,this.cfg,a);this.elems={};this._={};this.init()};b.prototype={init:function(){var a=this;this.elems.io=e({el:"iframe",name:"FOCUS_UPLOAD_IO_"+FOCUS.util.random(0,1E3),src:FOCUS.util.browser.msie?"javascript:document.open();"+(k.domain===g.location.hostname?"":"document.domain='"+k.domain+"';")+
"void(0)":"about:blank"});this.elems.io.style.cssText="position:absolute; width:1px; height:1px; top: -9999px; left:-9999px;";k.body.appendChild(a.elems.io);setTimeout(function(){a.elems.win=a.elems.io.contentWindow;a.elems.doc=a.elems.io.contentWindow.document},25);this._.timer=-1;this._.handle={load:function(){if(a._.submited){clearTimeout(a._.timer);var d=a._.handle.getData(a.elems.io);"undefined"===FOCUS.util.type(d)?a.cfg.events.error.call(this,"IO_ERROR"):a.cfg.events.load.call(this,d);a._.submited=
!1;setTimeout(function(){a._deleteForm()},25)}},error:function(){a.cfg.events.error.call(this);a._.submited=!1},getData:function(d){var a;try{a=d.contentWindow.document.body.innerHTML.replace(/(^|)\<\/?pre[^\>]*\>(|$)/gi,"")}catch(b){}return a}};this.elems.io.attachEvent?this.elems.io.attachEvent("onload",this._.handle.load):this.elems.io.onload=this._.handle.load},open:function(a,d){this._.openCfg={method:"GET"===a.toUpperCase()?"GET":"POST",action:d}},send:function(a,d){var b=this;setTimeout(function(){var c=
{el:"form",name:"FOCUS_UPLOAD_FORM_"+FOCUS.util.random(0,1E3),method:b._.openCfg.method,action:b._.openCfg.action||""};c.target=b.elems.io.name;var h=[],g=!1,p,l;for(l in a.elems)p=a.elems[l],"file"===p.type&&(g=!0),h.push(p);c.enctype=g?"multipart/form-data":"application/x-www-form-urlencoded";b._deleteForm();var u=b.elems.__submit_form=e(c);u.style.cssText="position:absolute; width:1px; height:1px; top: -9999px; left:-9999px;";for(k.body.appendChild(u);h.length;)u.appendChild(h.shift());d=d||b.cfg.charset||
"UTF-8";var x;FOCUS.util.browser.msie&&(x=k.charset);FOCUS.util.browser.msie?k.charset=d:u.acceptCharset=d;setTimeout(function(){b._.submited=!0;u.submit();setTimeout(function(){FOCUS.util.browser.msie&&(k.charset=x)},1)},25)},100)},onload:function(a){this.cfg.events.load=a},onerror:function(a){this.cfg.events.error=a},overrideGetData:function(a){this._.handle.getData=a},setUrl:function(a){this.elems.__submit_form.action=a},_deleteForm:function(){try{this.elems.__submit_form&&this.elems.__submit_form.parentNode.removeChild(this.elems.__submit_form)}catch(a){}delete this.elems.__submit_form},
_deleteIO:function(){try{this.elems.io&&(this.__removeOnloadEvent(),this.elems.io.parentNode.removeChild(this.elems.io))}catch(a){}delete this.elems.doc;delete this.elems.win;delete this.elems.io},dispose:function(){this._deleteForm();this._deleteIO()},__removeOnloadEvent:function(){this.elems.io&&(this.elems.io.detachEvent?this.elems.io.detachEvent("onload",this._.handle.load):this.elems.io.onload=c)}};l.IO_Iframe=b}.call(this,window,document);
void function(g,k,l){g=FOCUS.namespace("FOCUS.widget.io.iframe");var c=g.IO_FormData,e=g.IO_Iframe,b=function(){};k=function(a){this.cfg={events:{error:b,load:b,progress:b,abort:b},progressURL:"",charset:"UTF-8",timeout:1E5};this._={cancel:!1,timeout:!1,loaded:!1,timeoutTimer:-1};this.elems={};this.set(a);this.init()};k.prototype={init:function(){var a=this;this._.getProgress=function(){var d=arguments.callee;if(a.cfg.progressURL&&!a._.loaded){a.elems.io_progress=new e;a.elems.io_progress.onload(function(b){setTimeout(function(){a.elems.io_progress.dispose()},
25);a._.loaded||(b=FOCUS.util.JSON.parse(b),a.cfg.events.progress.call(b),setTimeout(function(){d()},100))});a.elems.io_progress.open("GET",a.cfg.progressURL,!0);var b=new c;b.append("progress","loaded");a.elems.io_progress.send(b)}}},send:function(a){var d=this;this._.timeoutTimer=setTimeout(function(){d.timeout()},this.cfg.timeout);this.elems.io.send(a,this.cfg.charset);setTimeout(function(){d._.cancel||d.cfg.events.progress.call(d,{loaded:0,total:100})},1);this._.getProgress()},open:function(a,
d){this._.fullProgress=!1;this.reset();this.elems.io.open(a,d)},set:function(a){FOCUS.util.extend(!0,this.cfg,a)},reset:function(){var a=this;this.elems.io&&this.elems.io.dispose();this.elems.io_progress&&this.elems.io_progress.dispose();this.elems.io=new e({timeout:this.cfg.timeout});this.elems.io.onload(function(d){a._.timeout||(a._.fullProgress||(a.cfg.events.progress.call(a,{loaded:100,total:100}),a._.fullProgress=!0),clearTimeout(a._.timeoutTimer),a._.cancel||(a._.loaded=!0,a.cfg.events.load.call(a,
d,this)))});this.elems.io.onerror(function(d){clearTimeout(a._.timeoutTimer);a._.cancel||a.cfg.events.error.call(a,this,d)});this._.cancel=!1;this._.timeout=!1;this._.loaded=!1;this._.timeoutTimer=-1},dispose:function(){this.elems.io&&(this.elems.io.dispose(),delete this.elems.io);this.elems.io_progress&&(this.elems.io_progress.dispose(),delete this.elems.io_progress)},timeout:function(){this._.timeout=!0;this.elems.io.__removeOnloadEvent();this.cfg.events.error.call(this,this,"timeout")},abort:function(){this._.cancel=
!0;clearTimeout(this._.timeoutTimer);this.elems.io&&this.elems.io.__removeOnloadEvent();this.cfg.events.abort()}};g.Poster=k}.call(this,window,document);
void function(g,k,l){var c=FOCUS.util.createElement,e=FOCUS.widget.io.iframe.Poster,b=FOCUS.widget.io.iframe.IO_FormData,a=function(){};FOCUS.widget.Upload_Iframe=function(d){this.constructor=arguments.callee;this.mode=FOCUS.widget.Upload.MODE.IFRAME;this.elems={};this.cfg={events:{ready:a,loadFailed:a,dialogStart:a,dialogComplete:a,queued:a,queueError:a,uploadStart:a,uploadProgress:a,uploadSuccess:a,uploadError:a,uploadComplete:a},button:{text:"Upload"},multiple:!0,sizeLimit:-1,queueLimit:-1,fileTypes:FOCUS.widget.Upload.MIME_TYPE.ALL,
fileTypesDescription:"All Files",uploadURL:"",filePostName:"",placeholder:"",charset:FOCUS.widget.Upload.CHARSET.DEFAULT,debug:!1,timeout:1E5};this._={queue:[],uploadingFile:null,uploadedFile:[],status:FOCUS.widget.Upload.TURNING.ON};this.set(d);this.init()};FOCUS.widget.Upload_Iframe.prototype=new FOCUS.widget.UploadBase;FOCUS.util.extend(!0,FOCUS.widget.Upload_Iframe.prototype,{init:function(){var a=this;this.elems.holder=c({el:"div"});this.elems.holder.style.cssText="";var e={missing_url:[FOCUS.widget.Upload.UPLOAD_ERROR.MISSING_UPLOAD_URL,
"missing upload URL."],invalid_filetype:[FOCUS.widget.Upload.QUEUE_ERROR.INVALID_FILETYPE,"File is not an allowed file type."],size_limit:[FOCUS.widget.Upload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT,"File size exceeds allowed limit."],chain_error:[FOCUS.widget.Upload.QUEUE_ERROR.CHAIN_ERROR,"Some reason to occured chain error."]};FOCUS.util.extend(this._,{post:function(c){var e=new b;if("object"===FOCUS.util.type(a.cfg.postParams))for(var f in a.cfg.postParams)e.append(f,a.cfg.postParams[f]);e.append(a.cfg.filePostName||
c.id,c.data);a.elems.poster.open("POST",a.cfg.uploadURL,!0);a.elems.poster.send(e)},start:function(b){if(b=a.getQueueFile())!a.cfg.uploadURL||"string"!==FOCUS.util.type(a.cfg.uploadURL)?(a.cfg.events.uploadError.apply(a,[b].concat(e.missing_url)),a.stopUpload()):(b.status=FOCUS.widget.Upload.FILE_STATUS.IN_PROGRESS,a._.uploadingFile=b,a.cfg.events.uploadStart.call(a,b),a._.post(b))},dialogStart:function(b){b=b||g.event;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0;a.cfg.events.dialogStart.call(a)},
__queued:function(b,c){var f=[],g=[],k=a._.queue,l=new FOCUS.widget.Upload.File(this);if(this.files&&(!FOCUS.util.browser.firefox||FOCUS.util.browser.firefox&&3.6<=FOCUS.util.browser.version)){var q=[],w=!1,r;if(-1!==a.cfg.queueLimit&&this.files.length+a._.queue.length>a.cfg.queueLimit){for(var n=0,t=this.files.length;n<t;n++)r=new FOCUS.widget.Upload.File(this.files[n]),f.push(r),a.cfg.events.queueError.call(a,r,FOCUS.widget.Upload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED,a.cfg.queueLimit);w=!0}else for(var y=
FOCUS.util.sizeConvert.unit2Bytes(a.cfg.sizeLimit),n=0,t=this.files.length;n<t;n++){r=new FOCUS.widget.Upload.File(this.files[n]);f.push(r);var v;if(FOCUS.util.mimeValidation(a.cfg.fileTypes,r.type)){if(-1!==a.cfg.sizeLimit&&(r.fileSize||r.size)>y)v=e.size_limit}else v=e.invalid_filetype;v?(a.cfg.events.queueError.apply(a,[r].concat(v)),w=!0):q.push(r)}if(w){n=0;for(t=q.length;n<t;n++)q[n].id=l.id,a.cfg.events.queueError.apply(a,[q[n]].concat(e.chain_error))}else{n=0;for(t=q.length;n<t;n++)q[n].status=
FOCUS.widget.Upload.FILE_STATUS.QUEUED,q[n].id=l.id,a.cfg.events.queued.call(a,q[n]);g=g.concat(q);k.push(l)}delete q}else f.push(l),FOCUS.util.mimeValidation(a.cfg.fileTypes,l.type)?(g.push(l),k.push(l),l.status=FOCUS.widget.Upload.FILE_STATUS.QUEUED,a.cfg.events.queued.call(a,l)):a.cfg.events.queueError.apply(a,[l].concat(e.invalid_filetype));b&&(a.elems.selector.parentNode.removeChild(a.elems.selector),a.elems.selector=a._._crateSelector(a.elems.holder,a._.dialogStart,a._.dialogComplete));"function"===
FOCUS.util.type(c)&&c.call(a,f.length,g.length,k.length);delete f;delete g;delete k},dialogComplete:function(b){b=b||g.event;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0;a._.__queued.call(this,!0,a.cfg.events.dialogComplete)},uploadProgress:function(b){var c=a.getQueueFile();c.status=FOCUS.widget.Upload.FILE_STATUS.IN_PROGRESS;b.loaded===b.total&&(c.fullProgress=!0);a.cfg.events.uploadProgress.call(a,c,b.loaded,b.total)},uploadSuccess:function(b,c){var e=a.elems.poster,f=a.getQueueFile();
a.cfg.events.uploadSuccess.call(a,f,b,e)},uploadError:function(b,c){c=(c||"").toUpperCase();var e=a.getQueueFile();e.status=FOCUS.widget.Upload.FILE_STATUS.ERROR;a.cfg.events.uploadError.call(a,e,FOCUS.widget.Upload.UPLOAD_ERROR[c?c:"UPLOAD_FAILED"],c?c:"TIMEOUT");a._.uploadComplete(!0)},uploadComplete:function(b,c){var e=a.getQueueFile();!b&&(!e.fullProgress&&!c)&&(a._.uploadProgress.call(a,{loaded:e.size,total:e.size}),e.fullProgress=!0);c||(e.status=FOCUS.widget.Upload.FILE_STATUS.COMPLETE);a._.queue.shift();
a._.uploadingFile=null;a.cfg.events.uploadComplete.call(a,e)},complete:function(b,c){a._.uploadSuccess.call(a,b,c);a._.uploadComplete.call(a);setTimeout(function(){a.elems.poster&&(a.elems.poster.dispose(),delete a.elems.poster)},25)},abort:function(){a._.uploadComplete(!1,!0)},_crateSelector:function(b,e,f){var g=c({el:"input",type:"file",name:"FOCUS_FILE_"+FOCUS.util.random(0,100),multiple:!!a.cfg.multiple});b.appendChild(g);FOCUS.util.event.bind(g,"click",e);FOCUS.util.event.bind(g,"change",f);
a.__setStyle("iframe",a.elems.holder,g,a.cfg.button.text);return g}});var f=FOCUS.query?FOCUS.query(this.cfg.placeholder):k.getElementById(this.cfg.placeholder.replace(/^#/,""));f&&("length"in f&&(f=f[0]),f&&(f.parentNode.insertBefore(this.elems.holder,f),a.elems.selector=this._._crateSelector(this.elems.holder,this._.dialogStart,this._.dialogComplete),f.parentNode.removeChild(f)))},startUpload:function(){this.elems.poster&&this.elems.poster.dispose();this.elems.poster=new e({events:{abort:this._.abort,
load:this._.complete,error:this._.uploadError,progress:this._.uploadProgress},progressURL:this.cfg.progressURL,charset:this.cfg.charset,timeout:this.cfg.timeout||1E5});this._.start()},queue:function(a,b){if(a){a.length===l&&(a=[a]);for(var c=0;c<a.length;c++)this._.__queued.call(a[c],!1,b)}}})}.call(this,this,this.document);
