/**
* upload
* @version 0.6.7
* @namespace FOCUS.widget
* @author lvxiang
*/
;void function(window, document, undefined){
	if(!window.FOCUS){
		window.FOCUS = {};
	}
	
	FOCUS.namespace = function(){
		var args = [].slice.call(arguments);
		var ns, tmp, prev;
		var ret = [];

		while(args.length){
			ns = args.shift().split(/\./);
			prev = window;

			while(ns.length){
				tmp = ns.shift();
				if(!prev[tmp]){
					prev[tmp] = {};
				}

				prev = prev[tmp];
			}
			
			ret.push(prev);
		}
		
		return ret.length > 1 ? ret : ret[0];
	};
	

	FOCUS.BASEPATH = window.FOCUS_BASEPATH || function(scripts){
		var location = window.location;
		var domain = /^(\w+\:\/{2,3}.+?)\//.exec(location.href)[1];
		var r_base = /(^\/?|.*?\/)FOCUS\/[^?#]+\.js(?:[?#].*)?$/;
		var r_isAbsPath = /^\w+\:\/\//;
		var r_isBackslash = /^\//;
		var r_path = /^.*\//;
		var base;
		var match;
		
		for(var i = 0, len = scripts.length; i < len; i++){
			var url = scripts[i].src;
			if(!r_isAbsPath.test(url)){
				if(r_isBackslash.test(url)){
					url = domain + url;
				}else{
					url = r_path.exec(location.href)[0] + url;
				}
			}else{ }
			
			match = r_base.exec(url);
			
			if(match){
				base = match[1];
				break;
			}
		}
		
		if(!base){
			base = r_path.exec(location.href)[0];
		}else{
			//if(location.protocol !== 'file:'){
				//if(base.indexOf(location.protocol) !== -1){
					base = base.replace(new RegExp(location.protocol + '\\/\\/' + location.host, 'i'), '');
				//}
				
				base = location.protocol + '\/\/' + location.host + base + 'FOCUS/';
			//}else{ }
		}
		
		return base;
	}(document.getElementsByTagName('script'));
}.call(this, this, this.document);
;void function(window, document, undefined){
	FOCUS.namespace('FOCUS.util');
	
	/**
	* type
	*/
	FOCUS.util.type = function(o){
		var _type;
		var r_native = /\{\s*\[native\s*code\]\s*\}/i;
		
		if(o === null){
			//for IE, use toString, it's '[object Object]'
			//for FF/Opera, it's '[object Window]'
			_type = 'null';
		}else if(typeof o === 'undefined'){
			//for IE, use toString, it's '[object Object]'
			//for FF/Opera, it's '[object Window]'
			_type = 'undefined';
		}else{
			_type = Object.prototype.toString.call(o).match(/\w+/g)[1].toLowerCase();
			
			//IE native function
			if(_type === 'object' && r_native.test(o + '')){
				_type = 'function';
			}
		}
		
		return _type;
	};
	
	/*
	* trim
	*/
	FOCUS.util.trim = function(str){
		return (str + '').replace(/^[\s\u00A0]+|[\s\u00A0]+$/g, '');
	};
	
	/*
	* JSON
	*/
	FOCUS.util.JSON = function(JSON){
		var _JSON = {};
		if(JSON){
			_JSON.stringify = JSON.stringify;
		}else{
			_JSON.stringify = function(){ return '' };
		}
		
		_JSON.parse = function(jsonStr){
			var ret;
			
			if(FOCUS.util.type(jsonStr) === 'string'){
				try{
					ret = new Function('return ' + jsonStr)();
				}catch(ex){
					ret = {};
				}
			}else{
				ret = jsonStr;
			}
			
			return ret;
		};
		
		return _JSON;
	}.call(this, window.JSON);
	
	
	/**
	* browser
	*/
	FOCUS.util.browser = function(ua){
		var r_msie = /msie\s*(\d+\.\d+)/;
		var r_ff = /firefox\/(\d+\.\d+)/;
		var r_webkit = /webkit\/(\d+\.\d+)/;
		var r_chrome = /chrome\/(\d+\.\d+)/;
		var r_safari = /safari\/(\d+\.\d+)/;
		var r_opera = /opera/;
		var r_ver = /version\/(\d+\.\d+)/;
		
		var ret = {};
		var match;
		
		match = r_msie.exec(ua);
		if(match){
			ret.msie = true;
			ret.version = match[1];
			
			return ret;
		}
		
		match = r_ff.exec(ua);
		if(match){
			ret.mozilla = ret.firefox = true
			ret.version = match[1];
			
			return ret;
		}
		
		match = r_webkit.exec(ua);
		if(match){
			ret.webkit = true;
			ret.version = match[1];
			
			if(window.chrome){
				ret.chrome = true;
				ret.version = r_chrome.exec(ua)[1];
				
				return ret;
			}
			
			match = r_safari.exec(ua);
			if(match){
				ret.safari = true;
				ret.version = [1];
			}
			
			return ret;
		}
		
		match = r_opera.exec(ua);
		if(match && window.opera){
			ret.opera = true;
			ret.version = r_ver.exec(ua)[1];
		}

		return ret;
		
	}.call(this, window.navigator.userAgent.toLowerCase());
	
	/*
	* flash plugin
	*/
	FOCUS.util.flash = function(nav, plugins){
		var flash = {
			has: false,
			version: 0
		};

		//flash check
		var SHOCKWAVE_FLASH = "Shockwave Flash";
		var SHOCKWAVE_FLASH_AX = "ShockwaveFlash.ShockwaveFlash";
		var FLASH_MIME_TYPE = "application/x-shockwave-flash";
		
		if(plugins.length && plugins[SHOCKWAVE_FLASH]){
			if (plugins[SHOCKWAVE_FLASH].description && !(typeof nav.mimeTypes !== 'undefined' && nav.mimeTypes[FLASH_MIME_TYPE] && !nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) { // navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin indicates whether plug-ins are enabled or disabled in Safari 3+
				flash = {
					has: true,
					version: /\d+\.\d+/.exec(plugins[SHOCKWAVE_FLASH].description)[0]
				};
			}
		}else if(window.ActiveXObject){
			var ax;
			var rv = /\d+/g;

			try{
				ax = new ActiveXObject(SHOCKWAVE_FLASH_AX);
			}catch(ex){}

			if(ax){
				rv.exec('');
				flash = {
					has: true,
					version: ax.GetVariable("$version").match(rv).join('.')
				};
			}
		}
		
		return flash;
	}.call(this, window.navigator, window.navigator.plugins);
	
	/**
	* extend
	*/
	FOCUS.util.extend = function(){
		var me = arguments.callee;
		var start, override;

		if(FOCUS.util.type(arguments[0]) !== 'object'){
			start = 1;
			override = !!arguments[0];
		}else{
			start = 0;
			override = false;
		}

		var tar = arguments[start] || {};
		var args = [].slice.call(arguments, start + 1);
		
		var tmp;
		var type;
		while(args.length){
			tmp = args.shift();
			if(FOCUS.util.type(tmp) !== 'object'){
				continue;
			}
			
			var t;
			for(var key in tmp){
				t = tmp[key];
				
				if(FOCUS.util.type(t) === 'object'){
					if(t == window || t == document || ('childNodes' in t && 'nextSibling' in t && 'nodeType' in t)){
						if(!(!override && (key in tar))){
							tar[tar] = t;
						}
						
						continue;
					}
					
					type = FOCUS.util.type(tar[key]);
					if(!(key in tar) || type === 'undefined' || type === 'null'){
						tar[key] = {};
					}
					
					if(FOCUS.util.type(tar[key]) === 'object'){
						me(override, tar[key], t);
					}
				}else if(!(!override && (key in tar))){
					tar[key] = t;
				}
				
			}
		}
		
		return tar;
	};
	
	/*
	* log4js
	*/
	FOCUS.util.console = function(console){
		var logStat = false;
		var noop = function(){};
		
		var SWITCH = {
			ON: true,
			OFF: false
		};
		
		var _loger = {
			SWITCH: SWITCH,
			turn: function(stat){
				logStat = SWITCH[!!stat ? 'ON' : 'OFF'];
			},
			log: noop,
			info: noop,
			warn: noop,
			error: noop,
			debug: noop
		};
		
		if(!console){
			return _loger;
		}
		
		if(!console.debug){
			console.debug = console.log;
		}
		
		if(!console.error){
			console.error = console.warn;
		}
		
		return FOCUS.util.extend(true, _loger, {
			log: function(msg){
				if(logStat === SWITCH.ON){
					console.log(msg);
				}
			},
			info: function(msg){
				if(logStat === SWITCH.ON){
					console.info(msg);
				}
			},
			warn: function(msg){
				if(logStat === SWITCH.ON){
					console.warn(msg);
				}
			},
			error: function(msg){
				if(logStat === SWITCH.ON){
					console.error(msg);
				}
			},
			debug: function(msg){
				if(logStat === SWITCH.ON){
					console.debug(msg);
				}
			}
		});
	}.call(window, window.console);
	
	/*
	* indexOf
	*/
	FOCUS.util.indexOf = function(items, value){
		if(items.indexOf){
			return items.indexOf(value);
		}
		
		var ret = -1;
		var i = 0, len = items.length;
		for(; i < len; i++){
			if(items[i] === value){
				ret = i;
				break;
			}
		}
		
		return ret;
	};
	
	/*
	* unique array
	*/
	FOCUS.util.unique = function(arr){
		var ret = [];
		
		for(var i = 0, len = arr.length; i < len; i++){
			if(FOCUS.util.indexOf(ret, arr[i]) === -1){
				ret.push(arr[i]);
			}
		}
		
		return ret;
	};
	
	/*
	* random  -- Int
	*/
	FOCUS.util.random = function(){
		var cache = {};
		
		return function(min, max, clear){
			min = min || 0;
			max = FOCUS.util.type(max) === 'number' && !isNaN(max)
				? max === min
					? max + 10
					: max
				: min + 10;
			
			var group = min + '_' + max;
			
			if(!cache[group]){
				cache[group] = [];
			}
			
			if(cache[group].length === max - min){
				cache[group] = [];
				FOCUS.util.type(clear) === 'function' && clear.call(this);
			}
			
			var ret;
			while(true){
				ret = min + ~~(Math.random() * (max - min));
				if(FOCUS.util.indexOf(cache[group], ret) === -1){
					cache[group].push(ret);
					break;
				}
			}
			
			return ret;
		};
	}.call(this);
	
	/**
	* create element
	*/
	FOCUS.util.createElement = function(){
		var closeSelf = ',meta,base,link,img,input,br,hr,area,sharp,';
	
		var tagStrConstructor = function(config){
			var cfg = FOCUS.util.extend(true, {}, config);
			
			var fragment = ['<', cfg.el];
			var el = cfg.el;
			delete cfg.el;
			
			for(var name in cfg){
				fragment.push(' ', name, '="', cfg[name], '"');
			}
			
			fragment.push((closeSelf.indexOf(',' + el + ',') === -1 ? ('></' + el + '>') : ' />'));
			
			return fragment.join('');
		};
		
		//elems generator
		var _createElem = function(config){
			var cfg = {};
			FOCUS.util.extend(true, cfg, config);
			
			var el = tagStrConstructor(cfg);
			var elem;

			var fail = false;
			
			try{
				elem = document.createElement(el);
			}catch(ex){
				fail = true;
				elem = document.createElement(cfg.el);
				delete cfg.el;
			}
			
			if(fail){
				for(var key in cfg){
					elem[key] = cfg[key];
				}
			}
			
			if(elem.tagName.toLowerCase() === 'input'){
				var type = cfg.type ? cfg.type : 'text';
				elem.type = type;
			}
			
			return elem;
		};
		
		return _createElem;
	}.call(this);
	
	/*
	* event
	*/
	FOCUS.util.event = function(){
		var __bind = function(standard){
			return standard
				? function(elem, type, event){
					elem.addEventListener(type, event, false);
				}
				: function(elem, type, event){
					elem.attachEvent('on' + type, event);
				}
		}.call(this, !!window.addEventListener);
		
		var __remove = function(standard){
			return standard
				? function(elem, type, event){
					elem.removeEventListener(type, event);
				}
				: function(elem, type, event){
					elem.detachEvent('on' + type, event);
				}
		}.call(this, !!window.removeEventListener);
		
		var prefix = 'FOCUS_EVENTS_'
		var uuid = (new Date).valueOf();
		var group = prefix + uuid;
		
		var execEvent = function(e, events){
			for(var i = 0, len = events.length; i < len; i++){
				events[i].handler.apply(this, [e].concat(events[i].params));
			}
		};
		
		var find = function(events, event){
			var ret = -1;
			for(var i = 0, len = events.length; i < len; i++){
				if(events[i].handler === event){
					ret = i;
					break;
				}
			}
			
			return ret;
		};
		
		var _bind = function(elem, type, event){
			if(!elem[group]){
				elem[group] = {};
			}
			
			var events = elem[group];
			
			if(!events[type]){
				events[type] = [];
				__bind(elem, type, function(e){
					e = e || window.event;
					
					execEvent.call(elem, e, events[type]);
				});
			}
			
			events[type].push({
				handler: event,
				params: [].slice.call(arguments, 3)
			});
		};
		var _remove = function(elem, type, event){
			if(!elem[group] || (elem[group] && !elem[group][type]) || (elem[group] && !elem[group][type].length)){
				return; 
			}
			
			var events = elem[group][type];
			if(!event){
				events = [];
				return;
			}
			
			var index = find(events, event);
			if(index == -1){
				return;
			}
			
			events.splice(index, 1);
		};
		
		return {
			bind: _bind,
			remove: _remove
		};
	}.call(this);
	
	/*
	* upload environment feature
	*/
	FOCUS.util.feature_upload = function(nav){
		var _flash = function(){
			var flash = FOCUS.util.flash;
			var ret = flash.has;
			
			//win vista/7 + flash plugin 11.3 + ff 4-13 == problem
			if(flash && flash.has && nav.oscpu && FOCUS.util.browser.firefox && FOCUS.util.browser.version >= 4 && FOCUS.util.browser.version <= 13){
				var r_sys = /windows\s*nt\s*([\d\.]+)/i;
				var match = r_sys.exec(nav.oscpu);
				
				if(match && (/^6\.0/.test(match[1]) || /^6\.1/.test(match[1])) && /^11\.3/.test(flash.version)){
					ret = false;
				}
			}
			
			return ret;
		}.call(this);
		
		var _html5 = function(){
			if(FOCUS.util.browser.firefox && FOCUS.util.browser.version < 3.6){
				return false;
			}
			
			var ret = {};
			
			var fileElem = document.createElement('input');
			fileElem.type = 'file';
			fileElem.style.cssText = 'position:absolute; top:-999px; height:-999px;';
			document.body.appendChild(fileElem);
			
			//setTimeout(function(){
				ret.file = !!fileElem.files;
				ret.multiple = ('multiple' in fileElem) && !(FOCUS.util.browser.apple && FOCUS.util.browser.version < 6);
				
				document.body.removeChild(fileElem);
				delete fileElem;
			//}, 25);
			
			if(!window.XMLHttpRequest){
				ret = false;
				return ret;
			}
			
			var xhr = new XMLHttpRequest();
			//standard html5 xhr object
			ret.upload = !!xhr.upload;
			//ff
			ret.sendAsBinary = !!xhr.sendAsBinary;
			//native FormData
			ret.FormData = !!window.FormData && !window.FormData.customized;
			
			delete xhr;
			
			return ret;
		}.call(this);
		
		var _iframe = function(){
			var ret = {};
			var domain = document.domain;
			var host = window.location.host || window.location.hostname;
			
			ret.sameDomain = domain === host;
			
			return ret;
		}.call(this);
		
		return {
			html5: _html5,
			flash: _flash,
			iframe: _iframe
		};
	}.call(this, window.navigator);
	
	FOCUS.util.sizeConvert = function(){
		var Unit = {
			KB: 1024,
			MB: 1024 * 1024,
			GB: 1024 * 1024 * 1024/*,
			TB: 1024 * 1024 * 1024,
			PB: 1024 * 1024 * 1024 * 1024*/
		};
		
		var UnitSize = function(size, unit){
			this.size = size;
			this.unit = unit;
		};
		
		UnitSize.prototype = {
			toString: function(){
				return this.size + ' ' + this.unit;
			},
			valueOf: function(){
				return this.size;
			}
		};

		var r_unit = /^((?:\d+)(?:\.\d+)?)\s*([A-Za-z]*)$/g;
		var r_hasUnit = /([A-Za-z]+)$/;
		
		/*
		* convert Size with Unit to Size in bytes
		*/
		var _unit2Bytes = function(unitSize){
			var size = 0;
			
			if(r_hasUnit.test(unitSize)){
				r_unit.exec('');
				var unit = r_unit.exec(unitSize);
				if(unit){
					size = (parseFloat(unit[1]) || 0) * (unit[2] ? Unit[unit[2].toUpperCase()] : 1024);
				}else{}
			}else{
				size = parseInt(unitSize) || 0;
			}
			
			//size === 0  ===> no size limit(-1)
			size = size || 0;

			return size;
		};
		
		
		/*
		* convert Size in bytes to Size with Unit
		*/
		var _bytes2Unit = function(bytes, unit){
			var size = 0;
			var unitList = ['GB', 'MB', 'KB'];
			
			unit = unit || '';
			if(!unit){
				for(var i = 0; i < unitList.length; i++){
					if(bytes > Unit[unitList[i]]){
						unit = unitList[i];
						break;
					}
				}
			}
			
			if(unit){
				size = bytes / Unit[unit];
			}
			
			size = size || 0;
			size = new UnitSize(size, unit);
			
			return size;
		};
		
		return {
			unit2Bytes: _unit2Bytes,
			bytes2Unit: _bytes2Unit
		};
	}.call(this);
	
	//FormData  -- for FireFox 3.x (has no class FromData, has xhr.sendAsBinary)
	if(!window.FormData && FOCUS.util.feature_upload.html5.sendAsBinary){
		window.FormData = function(charset){
			this.charset = charset || 'UTF-8';
			this.reset();
		};
		window.FormData.prototype = {
			append: function(name, content){
				var _data = '';
				var EOL = this.EOL;
				var boundary = '--' + this.boundary;
				
				var type = FOCUS.util.type(content);
				
				if(type === 'object'){
					content = JSON.stringify(content);
					type = 'string';
				}
				
				_data += boundary + EOL;
				_data += 'Content-Disposition: form-data; ';
				
				if(type === 'file'){
					_data += 'name="' + this.encode(name) + '"; ';
					_data += 'filename="' + this.encode(content.filename || content.name) + '"' + EOL;
					_data += 'Content-Type: ' + (content.type ? content.type : 'application/octet-stream') + EOL + EOL;
					_data += content.getAsBinary() + EOL;
				}else{
					_data += 'name="' + this.encode(name) + '"' + EOL + EOL;
					_data += this.encode(content) + EOL;
				}
				
				this.data += _data;
			},
			getData: function(){
				return this.data + '--' + this.boundary + '--' + this.EOL;
			},
			valueOf: function(){
				return this.getData();
			},
			toString: function(){
				return this.getData();
			},
			reset: function(){
				this.data = '';
				// 71 -- Firefox's tradition
				this.boundary = "---------------------------71" + (new Date).valueOf().toString(16).replace(/^0x/, '');
				this.EOL = '\r\n';
			},
			encode: function(str){
				if(FOCUS.util.transformCharset){
					return FOCUS.util.transformCharset(str, this.charset);
				}else{
					return encodeURI(str);
				}
			}
		};
		
		//customized flag
		window.FormData.customized = true;
	}
	
	
	var MIME_TYPE = {
		'*/*':			'*.*',
		'image/*':		'*.jpg; *.jpeg; *.jpe; *.png; *.gif',
		'image/png':	'*.png',
		'image/jpeg':	'*.jpg; *.jpeg; *.jpe',
		'image/jpg':	'*.jpg; *.jpeg; *.jpe',
		'image/gif':	'*.gif',
		'application/gzip':		'*.gz',
		'application/zip':		'*.zip',
		'application/vnd.ms-excel':	'*.xls',
		'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':	'*.xlsx',
		'application/msword':	'*.doc',
		'application/vnd.openxmlformats-officedocument.wordprocessingml.document':	'*.docx',
		'application/vnd.ms-powerpoint':	'*.ppt',
		'application/vnd.openxmlformats-officedocument.presentationml.presentation':	'*.pptx',
		'application/mshelp':		'*.hlp; *.chm',
		'application/pdf':			'*.pdf',
		'application/mp3':	'*.mp3',
		'text/html':		'*.html; *.htm; *.xhtml',
		'text/javascript':	'*.js',
		'text/css':			'*.css',
		'text/plain':		'*.txt',
		'default':		'*.*'
	};
	
	var FILE_TYPE = function(mime){
		var exclude = ['image/*', 'image/jpg', 'default'];
		var type = {};
		
		for(var key in mime){
			if(FOCUS.util.indexOf(exclude, key) === -1){
				mime[key].replace(/[^\;\u0020]+/g, function($1){
					type[$1] = key;
				});
			}
		}
		
		return type;
	}(MIME_TYPE);
	
	/*
	* '*.*; *.jpg' to MIME_TYPE
	*/
	FOCUS.util.convert2MimeTypes = function(types){
		types = types.split(/[\;\,]\s*/);
		
		var tmpRet = [];
		var ret = '';
		if(types.length){
			var r = /^[^\/]+\/[^\/]+$/;
			for(var i = 0; i < types.length; i++){
				if(r.test(types[i])){
					tmpRet.push(types[i]);
					continue;
				}
				
				if(types[i] in FILE_TYPE && types[i] !== '*.*'){
					tmpRet.push(FILE_TYPE[types[i]]);
				}else{
					ret = '*/*';
					break;
				}
			}
			
			if(!ret){
				ret = FOCUS.util.unique(tmpRet).join(', ');
			}
		}else{
			ret = '*/*';
		}
		
		return ret;
	};
	
	/*
	* MIME_TYPE to '*.*; *.jpg'
	*/
	FOCUS.util.convertMimeTypes = function(mime){
		mime = mime.split(/[\;\,]\s*/);
		
		var tmpRet = [];
		var ret = '';
		if(mime.length){
			var r = /^[^\\\/]+\.[^\\\/]+$/;
			for(var i = 0; i < mime.length; i++){
				if(r.test(mime[i])){
					tmpRet.push(mime[i]);
					continue;
				}
				
				if(mime[i] in MIME_TYPE && mime[i] !== '*/*'){
					tmpRet.push(MIME_TYPE[mime[i]]);
				}else{
					ret = '*.*';
					break;
				}
			}
			
			if(!ret){
				ret = FOCUS.util.unique(tmpRet).join('; ');
			}
		}else{
			ret = '*.*';
		}
		
		return ret;
	};
	
	/*
	* validate mime type
	*/
	FOCUS.util.mimeValidation = function(mimeSet, sub){
		if((mimeSet + '').indexOf('*/*') !== -1){
			return true;
		}
		
		sub = sub + '';
		var type = FOCUS.util.type(mimeSet);
		if(type === 'string'){
			mimeSet = mimeSet.split(/[\;\,\s]+/);
		}
		
		var ret = false;
		var r = /^([^\/]+)\/([^\/]+)$/;
		var matchSub = r.exec(sub);
		var match;
		
		if(!matchSub){
			return false;
		}
		
		for(var i = 0; i < mimeSet.length; i++){
			match = r.exec(mimeSet[i]);
			if(mimeSet[i] === sub
			|| (match[1] === matchSub[1] && (match[2] === '*' || match[2] === matchSub[2]))){
				ret = true;
				break;
			}
		}
		
		return ret;
	};
	
	/**
	* class
	*/
	FOCUS.util.addClass = function(elem, clazz){
		var clz = FOCUS.util.trim(elem.className).split(/\s+/);
		clz.push(clazz);
		elem.className = FOCUS.util.unique(clz).join(' ');
	};
	FOCUS.util.removeClass = function(elem, clazz){
		var clz = FOCUS.util.unique(FOCUS.util.trim(elem.className).split(/\s+/));
		var index = FOCUS.util.indexOf(clz, clazz);
		if(index !== -1){
			clz.splice(index, 1);
		}
		
		elem.className = clz.join(' ');
	};

}.call(this, this, this.document);






































;void function(window, document, undefined){
	FOCUS.namespace('FOCUS.widget');
	
	var noop = function(){};
	
	////required swfupload
	//FOCUS.widget.Upload_Flash = SWFUpload;
	
	var envir = function(){
		var feature = FOCUS.util.feature_upload;
		return {
			flash: feature.flash,
			html5: feature.html5 && (feature.html5.upload && /*feature.html5.file && */(feature.html5.sendAsBinary || feature.html5.FormData)),
			iframe: true
		}
	}.call(this);
	
	FOCUS.widget.Upload = function(cfg){
		this.cfg = {
			priority: FOCUS.widget.Upload.PRIORITY.DEFAULT,
			events: {
				ready: noop,
				loadFailed: noop,
				dialogStart: noop,
				dialogComplete: noop,
				queued: noop,
				queueError: noop,
				uploadStart: noop,
				uploadProgress: noop,
				uploadSuccess: noop,
				uploadError: noop,
				uploadComplete: noop
			},
			button: {
				//width: 120,
				//height: 32,
				text: 'Upload'
			},
			multiple: true,
			sizeLimit: -1,
			uploadLimit: -1,
			queueLimit: -1,
			fileTypes: FOCUS.widget.Upload.MIME_TYPE.ALL,
			uploadURL: '',
			filePostName: '',
			placeholder: '',
			debug: false,
			plugins: 'UploadEvents,AutoDisabled,Ready'
		};
		
		this.set(cfg);
		if(FOCUS.widget.Upload.plugins.UploadEvents){
			this.uploadEvents = new FOCUS.widget.Upload.plugins.UploadEvents(this.cfg.events);
			this.set({
				events: this.uploadEvents.events
			});
		}
		this._ = {};
		this.init();
		
		return this.instance;
	};
	FOCUS.widget.Upload.prototype = {
		init: function(){
			var _this = this;
			var that;
			var priority = this.cfg.priority;
			
			//setTimeout(function(){
				var type;
				for(var i = 0; i < priority.length; i++){
					if(envir[priority[i]]){
						type = priority[i];
						break;
					}
				}
				
				var CLZ = {
					'html5': 'Upload_HTML5',
					'flash': 'Upload_Flash',
					'iframe': 'Upload_Iframe'
				};
				
				if(type){
					if(type === FOCUS.widget.Upload.MODE.FLASH){
						rewriteFile();
						//wrap file object in flash event
						for(var ename in this.cfg.events){
							this.cfg.events[ename] = function(handle, ename){
								var _File = FOCUS.widget.Upload.File;
								return function(file){
									if(file && file.id){
										handle.apply(this, [new _File(file)].concat([].slice.call(arguments, 1)));
									}else{
										handle.apply(this, [].slice.call(arguments, 0));
									}
								};
							}.call(this, this.cfg.events[ename], ename);
						}
				
						this.cfg.fileTypes = FOCUS.util.convertMimeTypes(this.cfg.fileTypes); // mimetype ==> suffix type  ------> TODO
						this.cfg.placeholder = this.cfg.placeholder.replace(/^#/, '');

						var ready = this.cfg.events.ready;
						this.cfg.events.ready = function(ready){
							return function(){
								// make sure the flash loaded success
								setTimeout(function(){
									ready.call(_this.instance, type);
								}, 25);
							};
						}(ready);
					}else{ //
						this.cfg.fileTypes = FOCUS.util.convert2MimeTypes(this.cfg.fileTypes);
					}
					
					// UI & Events contruct
					this.instance = new FOCUS.widget[CLZ[type]](this.cfg);
					
					if(type !== FOCUS.widget.Upload.MODE.FLASH){
						// make sure the dom elements loaded && script excuted
						setTimeout(function(){
							// callback for choose which type to initialize
							_this.cfg.events.ready.call(_this.instance, type);
						}, 25);
					}else{ //Flash
						//that = this.instance;
						//this.instance = this.instance.instance;
					}
					
					var plugs = FOCUS.widget.Upload.plugins;
					//bind event handle
					if(plugs.UploadEvents){
						this.uploadEvents.bindThisObj(this.instance);
						'on,one,off,fire'.replace(/(\w+)/g, function($1){
							_this.instance[$1] = function(){
								_this.uploadEvents[$1].apply(_this.uploadEvents, arguments);
								return _this.instance;
							};
						});
					}
					
					//<--
					//execute plugins
					for(var pname in plugs){
						pname.replace(/([\$\^\[\]\\/\,\?\:\|\{\}\!\(\)\*\-\+])/g, '\\$1');
						if(pname !== 'UploadEvents' && new RegExp('(^|,)' + pname + '(,|$)').exec(this.cfg.plugins)){
							plugs[pname].call(this.instance, this.instance.mode);
						}
					}
					/////-->
				}else{
					throw 'not support this constructor.'
				}
			//}, 25);
		},
		set: function(cfg){
			var plugins = this.cfg.plugins;
			if(cfg.plugins && FOCUS.util.type(cfg.plugins) === 'string'){
				plugins += (',' + cfg.plugins);
				plugins = FOCUS.util.unique(plugins.split(/[,;\s]+/)).join(',');
			}
			
			FOCUS.util.extend(true, this.cfg, cfg);
			
			this.cfg.plugins = plugins;
		}
	};
	
	//rewrite the file class
	var rewriteFile = function(upload){
		return function(){
			upload.File = function(file){
				this.data = file;
				this.id = file.id;
				this.size = file.size;
				this.status = file.filestatus;
				this.suffix = file.type.replace(/^\./, '');
				this.type = upload.MIME_TYPE[this.suffix.toUpperCase()];
				this.fullname = file.name;

				var nameFrag = this.fullname.split(/\./);
				
				if(nameFrag.length > 1){
					nameFrag.pop();
				}else{ }
				
				this.name = nameFrag.join('.');
			};
		};
	}.call(this, FOCUS.widget.Upload);
}.call(this, this, this.document);










































;void function(window, document, undefined){
	FOCUS.namespace('FOCUS.widget.Upload');
	
	var upload = FOCUS.widget.Upload;
	
	upload.MODE = {
		HTML5: 'html5',
		FLASH: 'flash',
		IFRAME: 'iframe',
		DEFAULT: 'html5'
	};
	
	upload.PRIORITY = {
		DEFAULT: [ upload.MODE.HTML5, upload.MODE.FLASH, upload.MODE.IFRAME ]
	};
	
	upload.MIME_TYPE = {
		ALL: '*/*',
		IMAGE: 'image/*',
		JPG: 'image/jpeg',
		JPEG: 'image/jpeg',
		PNG: 'image/png',
		GIF: 'image/gif',
		PDF: 'application/pdf',
		DOC: 'application/msword',
		DOCX: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
		XLS: 'application/vnd.ms-excel',
		XLSX: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
		PPT: 'application/vnd.ms-powerpoint',
		PPTX: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
		TXT: 'text/plain',
		UNKNOWN: 'application/octet-stream'
	};
	
	upload.QUEUE_ERROR = {
		QUEUE_LIMIT_EXCEEDED            : -100,
		FILE_EXCEEDS_SIZE_LIMIT         : -110,
		ZERO_BYTE_FILE                  : -120,
		INVALID_FILETYPE                : -130,
		CHAIN_ERROR						: -140 //use iframe method upload, if browser support html5, an error occured on one file object will lead other files to occured error
	};
	
	upload.UPLOAD_ERROR = {
		HTTP_ERROR                      : -200,
		MISSING_UPLOAD_URL              : -210,
		IO_ERROR                        : -220,
		SECURITY_ERROR                  : -230,
		UPLOAD_LIMIT_EXCEEDED           : -240,
		UPLOAD_FAILED                   : -250,
		SPECIFIED_FILE_ID_NOT_FOUND     : -260,
		FILE_VALIDATION_FAILED          : -270,
		FILE_CANCELLED                  : -280,
		UPLOAD_STOPPED                  : -290,
		RESIZE                          : -300,
		TIMEOUT							: -310
	};
	
	upload.FILE_STATUS = {
		QUEUED       : -1,
		IN_PROGRESS  : -2,
		ERROR        : -3,
		COMPLETE     : -4,
		CANCELLED    : -5,
		NEW			 : -6
	};
	
	upload.UPLOAD_TYPE = {
		SINGLE:	1,
		MULTI:	2
	};

	upload.BUTTON_ACTION = {
		SELECT_FILE             : -100,
		SELECT_FILES            : -110,
		START_UPLOAD            : -120,
		JAVASCRIPT              : -130,	// DEPRECATED
		NONE                    : -130
	};
	
	upload.CURSOR = {
		POINTER					: -2,
		DEFAULT					: -1
	};
	
	upload.CSS = {
		WRAP:		'FOCUS_UPLOAD_wrap',
		SELECTOR:	'FOCUS_UPLOAD_selector',
		FLASH:		'FOCUS_UPLOAD_flashWrap',
		TEXT:		'FOCUS_UPLOAD_text',
		DISABLED:	'FOCUS_UPLOAD_wrap_disabled',
		HOVER:		'FOCUS_UPLOAD_wrap_hover'
	};
	
	upload.CHARSET = {
		UTF8:		'UTF-8',
		GBK:		'GBK',
		GB2312:		'GB2312',
		BIG5:		'BIG5',
		DEFAULT:	'UTF-8'
	};
	
	upload.TURNING = {
		ON:		true,
		OFF:	false
	};
	
	var _getFilename = function(fullname, ret){
		ret = ret || {};
		
		var nameFrag = fullname.split(/\./);
			
		if(nameFrag.length > 1){
			ret.suffix = nameFrag.pop();
		}else{
			ret.suffix = '';
		}
		
		ret.name = nameFrag.join('.');
		
		return ret;
	};
	
	upload.File = function(file){
		var _file = { data: file };
		_file.id = 'FOCUS_UPLOAD_' + (FOCUS.util.random(0, 1000000) + ~~((new Date()).valueOf() / 10000000)).toString(16).toUpperCase();
		
		if(file.tagName && file.tagName.toLowerCase() === 'input' && file.type === 'file'){
			var r_fullname = /[^\/\\]+$/;
			var fullname = r_fullname.exec(file.value);
			if(fullname){
				_file.fullname = fullname[0];
				_getFilename(_file.fullname, _file);
			}
			
			if(_file.suffix){
				_file.type = _file.suffix.toUpperCase() in upload.MIME_TYPE ? upload.MIME_TYPE[_file.suffix.toUpperCase()] : '';
			}else{
				_file.type = '';
			}
		}else{
			_file.size = file.filesize || file.size || 0;
			_file.type = file.type || '';
			_file.fullname = file.filename || file.name || '';
			
			_getFilename(_file.fullname, _file);
			
			if(_file.suffix){
				_file.type = _file.suffix.toUpperCase() in upload.MIME_TYPE ? upload.MIME_TYPE[_file.suffix.toUpperCase()] : '';
			}else{
				_file.type = '';
			}
		}
		
		_file.status = upload.FILE_STATUS.NEW;
		
		return _file;
	};
}.call(this, this, this.document);
;void function(window, document){
	FOCUS.namespace('FOCUS.widget');
	
	var noop = function(){};
	
	FOCUS.widget.UploadBase = function(){
		/*this.elems = {};
		this.cfg = {
			priority: FOCUS.widget.Upload.PRIORITY.DEFAULT,
			events: {
				ready: noop,
				loadFailed: noop,
				dialogStart: noop,
				dialogComplete: noop,
				queued: noop,
				queueError: noop,
				uploadStart: noop,
				uploadProgress: noop,
				uploadSuccess: noop,
				uploadError: noop,
				uploadComplete: noop
			},
			button: {
				text: 'Upload'
			},
			// single or multi file(s) selection dialog
			// except: some browser such as ie6-9 not support multiple on input:file
			multiple: true,
			sizeLimit: -1,
			//uploadLimit: -1, //not support now
			queueLimit: -1,
			fileTypes: FOCUS.widget.Upload.MIME_TYPE.ALL,
			fileTypesDescription: 'All Files',
			uploadURL: '',
			filePostName: '',
			placeholder: '',
			charset: FOCUS.widget.Upload.CHARSET.DEFAULT,
			debug: false,
			timeout: 100000
		};
		
		this._ = {
			queue: [],
			uploadingFile: null
		};*/
	};
	FOCUS.widget.UploadBase.prototype = {
		init: noop,
		set: function(cfg){
			this.cfg = FOCUS.util.extend(true, this.cfg, cfg);
		},
		debug: function(stat){
			FOCUS.util.log.turn(!!stat);
		},
		//Propertis
		//TODO
		
		////////Methods
		startUpload: noop,
		getFile: noop,
		
		//////implementation methods
		cancelUpload: function(callback){
			var file = this.getQueueFile();
			if(file){
				file.status = FOCUS.widget.Upload.FILE_STATUS.CANCELLED;
				if(FOCUS.util.type(callback) === 'function'){
					this.one('uploadError', callback);
				}
				this.cfg.events.uploadError.call(this, file, FOCUS.widget.Upload.UPLOAD_ERROR.FILE_CANCELLED, 'file cancelled.');
				this.elems.poster && this.elems.poster.abort();
			}
		},
		stopUpload: function(callback){
			var file = this.getQueueFile();
			if(file){
				file.status = FOCUS.widget.Upload.FILE_STATUS.QUEUED;
				if(FOCUS.util.type(callback) === 'function'){
					this.one('uploadError', callback);
				}
				this.cfg.events.uploadError.call(this, file, FOCUS.widget.Upload.UPLOAD_ERROR.UPLOAD_STOPPED, 'upload stopped.');
				this.elems.poster && this.elems.poster.abort();
				this._.queue.unshift(file);
			}
		},
		getQueueFile: function(arg){
			arg = arg || 0;
			var type = FOCUS.util.type(arg);
			var queue = this._.queue;
			var file = null;
			
			if(type === 'number'){
				if(arg <= queue.length - 1){
					file = queue[arg];
				}else{ }
			}else if(type === 'string'){
				for(var i = 0; i < queue.length; i++){
					if(queue[i].id === arg){
						file = queue[i];
						break;
					}
				}
			}
			
			return file;
		},
		////set
		setPostParam: function(params){
			if(!this.cfg.postParams){
				this.cfg.postParams = {};
			}
			
			FOCUS.util.extend(true, this.cfg.postParams, params);
		},
		addPostParam: function(key, value){
			if(!this.cfg.postParams){
				this.cfg.postParams = {};
			}
			
			this.cfg.postParams[key] = value;
		},
		removePostParam: function(key){
			if(!this.cfg.postParams || !key){
				this.cfg.postParams = {};
				return;
			}
			
			if(key in this.cfg.postParams){
				delete this.cfg.postParams[key];
			}
		},
		setUploadURL: function(url){
			this.cfg.uploadURL = url + '';
		},
		setFilePostName: function(name){
			this.cfg.filePostName = name + '';
		},
		//require override
		setFileTypes: function(types){
			switch(this.mode){
				case FOCUS.widget.Upload.MODE.IFRAME:
				case FOCUS.widget.Upload.MODE.HTML5: {
					types = FOCUS.util.convert2MimeTypes(types);
					this.elems.selector.accept = types;
				}; break;
				case FOCUS.widget.Upload.MODE.FLASH: {
					types = FOCUS.util.convertMimeTypes(types);
				}; break;
				default:;
			}
			
			this.cfg.fileTypes = types;
		},
		setFileSizeLimit: function(limit){
			this.cfg.sizeLimit = limit;
		},
		//not support now
		/*setFileUploadLimit: function(limit){
			this.cfg.uploadLimit = limit;
		},*/
		setFileQueueLimit: function(limit){
			this.cfg.queueLimit = limit;
		},
		__setStyle: function(mode, wrap, selector, text){
			var util = FOCUS.util;
			var CSS = FOCUS.widget.Upload.CSS;
			
			wrap.className = CSS.WRAP;
			
			if(util.browser.firefox){
				selector.size = 6;
			}
			
			selector.className = CSS.SELECTOR;
			
			var label;
			label = wrap.getElementsByTagName('label');
			if(label.length){
				wrap.removeChild(label[0]);
			}
			
			label = document.createElement('label');
			label.className = CSS.TEXT;
			label.innerHTML = text;
			wrap.insertBefore(label, selector);
			
			//hover
			util.event.bind(wrap, 'mouseover', function(e){
				e.cancelBubble = true;
				e.returnValue = false;
				
				util.addClass(wrap, CSS.HOVER);
			});
			FOCUS.util.event.bind(wrap, 'mouseout', function(e){
				e.cancelBubble = true;
				e.returnValue = false;
				
				util.removeClass(wrap, CSS.HOVER);
			});
		},
		__translateStatus: function(status){
			// status: ON / OFF / true / false
			// disable / able
			var type = FOCUS.util.type(status);
			if(type === 'string'){
				status = FOCUS.util.trim(status);
				if(status.length){
					status = !!FOCUS.widget.Upload.TURNING[status.toUpperCase()];
				}else{
					status = FOCUS.widget.Upload.TURNING.OFF;
				}
			}else if(type === 'undefined'){
				status = !this._.status;
			}else{
				status = !!status;
			}
			
			return status;
		},
		turn: function(status){
			status = this.__translateStatus(status);
			// TODO: switch able status
			// flash version require override
			
			var util = FOCUS.util;
			var CSS = FOCUS.widget.Upload.CSS;
			
			if(status !== this._.status){
				this.elems.selector.disabled = !status;
				this._.status = status;
				
				util[status ? 'removeClass' : 'addClass'](this.elems.holder, CSS.DISABLED);
			}
		},
		multiple: function(isMulti){
			this.elems.selector.multiple = !!isMulti;
		},
		/**
		* try to queue files.
		* -not support flash edition
		*/
		queue: function(){
			if(this.mode === FOCUS.widget.Upload.MODE.IFRAME || this.mode === FOCUS.widget.Upload.MODE.HTML5){
				//TODO
			}
		},
		/**
		* remove file out of queue. will not cause the error event.
		* @param {Int|String|Boolean} [arg] remove file out of queue.
			Int: index of the queue, greater than or equal 0
			String: file id of the queue files
			undefined: remove first file in the queue
			Boolean: -true empty the queue. -false remove first file in the queue
		*/
		dequeue: function(arg){
			if(this.mode === FOCUS.widget.Upload.MODE.IFRAME || this.mode === FOCUS.widget.Upload.MODE.HTML5){
				switch(FOCUS.util.type(arg)){
					case 'string': {
						for(var i = 0; i < this._.queue.length; i++){
							if(this._.queue[i].id === arg){
								arg = i;
								break;
							}
						}
					};
					case 'number': {
						this._.queue.splice(arg, 1);
					}; break;
					case 'undefined': {
						arg = false;
					}; break;
					case 'boolean': {
						if(arg){
							this._.queue.splice(0);
						}else{
							this._.queue.splice(0, 1);
						}
					}; break;
					default:;
				}
			}else if(this.mode === FOCUS.widget.Upload.MODE.FLASH){
				switch(FOCUS.util.type(arg)){
					case 'string':
					case 'number': {
						this.instance.cancelUpload(arg, false);
					}; break;
					case 'undefined': {
						arg = false;
					};
					case 'boolean': {
						if(arg){
							var file;
							while(file = this.instance.getQueueFile()){
								this.instance.cancelUpload(file.file_id, false);
							}
						}else{
							this.instance.cancelUpload(0, false);
						}
					}; break;
					default:;
				}
			}
		}
	};
}.call(this, this, this.document);
;void function(window, document){
	var plugs = FOCUS.namespace('FOCUS.widget.Upload.plugins');

	//<!-- Event -->
	/**
	* Class Event
	* @constructor
	* @name Event
	* @param {String} type event type
	*/
	var Event = function(type, thisObj){
		this.type = type;
		this.listeners = [];
		this._ = {
			thisObj: thisObj
		};
	};
	Event.prototype = {
		/**
		* @private
		* search handle in listeners
		* @param {Function} handle
		* @param {Number=0} startIndex
		* @return {Number} index of listeners
		*/
		__search: function(handle, startIndex){
			var ret = -1;
			for(var i = startIndex || 0; i < this.listeners.length; i++){
				if(this.listeners[i].handle === handle){
					ret = i;
					break;
				}
			}
			
			return ret;
		},
		/**
		* add events
		* @param {Object} cfg
		* @param {Function[]} cfg.handles
		* @param {Boolean} [cfg.once]
		* @param [cfg.thisObj]
		* @param [args,..]
		*/
		add: function(cfg, args){
			var handles = cfg.handles;
			var thisObj = cfg.thisObj || null;
			var once = cfg.once || false;
			var args = [].slice.call(arguments, 1)

			if(FOCUS.util.type(handles) === 'function'){
				handles = [handles];
			}
			if(FOCUS.util.type(handles) === 'array'){
				for(var i = 0; i < handles.length; i++){
					if(FOCUS.util.type(handles[i]) === 'function'){
						this.listeners.push({
							handle: handles[i],
							thisObj: thisObj,
							once: !!once,
							args: args
						});
					}
				}
			}
		},
		/**
		* add events
		* @param {Object} cfg
		* @param {Function[]} cfg.handles
		* @param {Boolean} [cfg.once]
		* @param [cfg.thisObj]
		* @param [args,..]
		*/
		one: function(cfg, args){
			if(FOCUS.util.type(cfg) !== 'object'){
				return;
			}
			
			cfg.once = true;
			this.add(cfg, [].slice.call(arguments, 1));
		},
		/**
		* remove event
		* @param {Function|Function[]} handles
		*/
		remove: function(handles){
			if(!handles){
				this.listeners = [];
				return;
			}
			if(FOCUS.util.type(handles) === 'function'){
				handles = [handles];
			}
			
			var index;
			for(var i = 0; i < handles.length; i++){
				if(FOCUS.util.type(handles[i]) === 'function' && (index = this.__search(handles[i])) !== -1){
					this.listeners.splice(index, 1);
				}
			}
		},
		/**
		* excute event
		* @param [args,..] event params
		*/
		exec: function(args){
			var listener;
			var onceEvents = [];
			for(var i = 0; i < this.listeners.length; i++){
				listener = this.listeners[i];
				if(listener.once){
					onceEvents.push(listener.handle);
				}
				
				listener.handle.apply(listener.thisObj || this._.thisObj || this, [].concat.call(listener.args, [].slice.call(arguments)));
			}
			
			this.remove(onceEvents);
		},
		/**
		* set this object in event handle excution context
		* @param thisObj
		*/
		bindThisObj: function(thisObj){
			this._.thisObj = thisObj;
		}
	};
	//<!-- Event END -->
	
	//<!-- Upload Events -->
	/**
	* events plugin for upload component
	* @constructor
	* @name UploadEvents
	* @requires FOCUS.base
	* @requires FOCUS.util
	* @requires FOCUS.widget.Upload
	* @requires Event
	* @param events {Object} added events on init
	* @param [thisObj]
	*/
	var UploadEvents = function(events, thisObj){
		this._ = {
			events: {},
			thisObj: thisObj
		};
		
		this.events = {};
		for(var type in events){
			this.on(type, events[type]);
			this.events[type] = function(type){
				var _this = this;
				if(type === 'uploadError'){
					return function(file, code, msg){
						switch(code){
							case FOCUS.widget.Upload.UPLOAD_ERROR.FILE_CANCELLED: {
								_this.fire.apply(_this, ['cancel', file, FOCUS.widget.Upload.UPLOAD_ERROR.FILE_CANCELLED, 'file cancelled.']);
							}; break;
							case FOCUS.widget.Upload.UPLOAD_ERROR.UPLOAD_STOPPED: {
								_this.fire.apply(_this, ['stop', file, FOCUS.widget.Upload.UPLOAD_ERROR.UPLOAD_STOPPED, 'upload stopped.']);
							}; break;
							default: {
								_this.fire.apply(_this, [type].concat([].slice.call(arguments)));
							};
						}
					};
				}else{
					return function(){
						_this.fire.apply(_this, [type].concat([].slice.call(arguments)));
					};
				}
			}.call(this, type);
		}
	};
	UploadEvents.prototype = {
		/**
		* @private
		*/
		__initEvent: function(type, handles, thisObj){
			if(!(type in this._.events)){
				this._.events[type] = new Event(type, this._.thisObj);
			}
			
			var cfg = {
				handles: handles,
				thisObj: thisObj
			};
			
			return cfg;
		},
		/**
		* bind event
		* @param {String} type event type
		* @param {Function|Function[]} handles event handles
		* @param [thisObj]
		* @param [args,..]
		*/
		on: function(type, handles, thisObj, args){
			var cfg = this.__initEvent(type, handles, thisObj);
			this._.events[type].add.apply(this._.events[type], [cfg].concat([].slice.call(arguments, 3)));
		},
		/**
		* remove event
		* @param {String} type event type
		* @param {Function|Function[]} [handles] remove handles
		*/
		off: function(type, handles){
			if(type in this._.events){
				this._.events[type].remove(handles);
			}
		},
		/**
		* bind once excuted event
		* @param {String} type event type
		* @param {Function|Function[]} handles event handles
		* @param [thisObj]
		* @param [args,..]
		*/
		one: function(type, handles, thisObj, args){
			var cfg = this.__initEvent(type, handles, thisObj);
			this._.events[type].one.apply(this._.events[type], [cfg].concat([].slice.call(arguments, 3)));
		},
		/**
		* trigger some event with the type
		* @param {String} type event type
		* @param [args,..]
		*/
		fire: function(type, args){
			if(type in this._.events){
				this._.events[type].exec.apply(this._.events[type], [].slice.call(arguments, 1));
			}
		},
		/**
		* set this object in all event handle excution context
		* @param thisObj
		*/
		bindThisObj: function(thisObj){
			this._.thisObj = thisObj;
			for(var type in this._.events){
				this._.events[type].bindThisObj(thisObj);
			}
		}
	};
	
	plugs.UploadEvents = UploadEvents;
	//<!-- Upload Events END -->
	
}.call(this, window, window.document);
/**
* @requires UploadEvents
*/
;void function(window){
	var plugs = FOCUS.namespace('FOCUS.widget.Upload.plugins');
	
	plugs.AutoDisabled = function(mode){
		this.on('uploadStart', function(){
			this.turn('off');
		}).on('uploadComplete', function(){
			this.turn('on');
		});
	};
}.call(this);
;void function(){
	var plugins = FOCUS.widget.Upload.plugins;
	var util = FOCUS.util;
	
	plugins.Ready = function(mode){
		var isReady = false;
		var _this = this;
		var handles = [];
		
		var exec = function(){
			while(handles.length){
				handles.shift().call(_this, mode);
			}
		};
		
		this.on('ready', function(){
			this.isReady = isReady = true;
			exec();
		});
		
		this.ready = function(fn){
			util.type(fn) === 'function' && handles.push(fn);
			
			if(isReady){
				exec();
			}
		};
	};
}.call(this);
;void function(window, document, undefined){
	var io = FOCUS.namespace('FOCUS.widget.io.iframe');
	var noop = function(){};
	
	//elems generator
	var createElem = FOCUS.util.createElement;

	//formdata
	var IO_FormData = function(/*url*/){
		this.elems = {};
		//this.elems.__submit_form = this._.form(url);
	};
	IO_FormData.prototype = {
		_: {
			/*form: function(url){
				return createElem({
					el: 'form',
					name: 'FOCUS_UPLOAD_FORM_' + FOCUS.util.random(0, 1000),
					method: 'POST',
					enctype: 'multipart/form-data',
					action: url || ''
				});
			},*/
			text: function(name, txt){
				return createElem({
					el: 'textarea',
					name: name,
					value: txt + ''
				});
			},
			radio: function(name, value, checked){
				return createElem({
					el: 'input',
					type: 'radio',
					name: name,
					value: value,
					checked: !!checked
				});
			},
			checkbox: function(name, value, checked){
				return createElem({
					el: 'input',
					type: 'checkbox',
					name: name,
					value: value,
					checked: !!checked
				});
			},
			file: function(inputFileElem, cfg){
				if(inputFileElem){
					var file = inputFileElem;//.cloneNode(true);
					cfg && cfg.name && (file.name = cfg.name);
					return file
				}else{
					var _cfg = {
						el: 'input',
						type: 'file'
					};
					
					FOCUS.util.extend(true, _cfg, cfg);

					return createElem(_cfg);
				}
			},
			clone: function(elem){
				return elem.cloneNode(true);
			}
		},
		append: function(name, value){
			var type = FOCUS.util.type(value);
			var elem;
			
			if(type !== 'string' && value.type === 'file'){
				elem = this._.file(value, { name: name });
			}else if(type === 'string'){
				elem = this._.text(name, value + '');
			}
			
			this.elems[name] = elem;
			//this.elems.__submit_form.appendChild(elem); //in ie6, here will leak the memory
		}
	};
	
	//
	io.IO_FormData = IO_FormData;
}.call(this, window, document);
;void function(window, document, undefined){
	var io = FOCUS.namespace('FOCUS.widget.io.iframe');
	var noop = function(){};
	//elems generator
	var createElem = FOCUS.util.createElement;
	
	//io
	var IO_Iframe = function(cfg){
		this.cfg = {
			events: {
				load: noop,
				error: noop
			},
			timeout: 100000,
			charset: 'UTF-8'
		};
		
		FOCUS.util.extend(true, this.cfg, cfg);
		this.elems = {};
		this._ = {};
		
		this.init();
	};
	IO_Iframe.prototype = {
		init: function(){
			var _this = this;

			this.elems.io = createElem({
				el: 'iframe',
				name: 'FOCUS_UPLOAD_IO_' + FOCUS.util.random(0, 1000),
				src: FOCUS.util.browser.msie
					? ('javascript:document.open();' + (document.domain === window.location.hostname
						? ''
						: ('document.domain=\'' + document.domain + '\';')) + 'void(0)')
					: 'about:blank'
				//src: 'javascript:document.open();document.domain="' + document.domain + '";void(0)'
			});
			
			this.elems.io.style.cssText = 'position:absolute; width:1px; height:1px; top: -9999px; left:-9999px;';

			document.body.appendChild(_this.elems.io);

			setTimeout(function(){
				_this.elems.win = _this.elems.io.contentWindow;
				_this.elems.doc = _this.elems.io.contentWindow.document;
			}, 25);
			
			//onload & onerror
			this._.timer = -1;
			this._.handle = {
				load: function(){
					if(_this._.submited){
						clearTimeout(_this._.timer);
						var data = _this._.handle.getData(_this.elems.io);
						if(FOCUS.util.type(data) === 'undefined'){
							_this.cfg.events.error.call(this, 'IO_ERROR');
						}else{
							_this.cfg.events.load.call(this, data);
						}
						_this._.submited = false;
						
						setTimeout(function(){
							_this._deleteForm();
						}, 25);
					}
				},
				error: function(){
					_this.cfg.events.error.call(this);
					_this._.submited = false;
				},
				//default getData, when Xdomain, override it
				getData: function(ifr){
					var data;
					try{
						//[Problem in chrome]
						// if cross domain, try...catch.. could not catch the 'unsafe error' tip
						var win = ifr.contentWindow;
						var doc = win.document;
						var body = doc.body;
						
						data = body.innerHTML.replace(/(^|)\<\/?pre[^\>]*\>(|$)/gi, '');
					}catch(ex){}
					
					return data;
				}
			};
			
			//bind load event
			this.elems.io.attachEvent
				? this.elems.io.attachEvent('onload', this._.handle.load)
				: (this.elems.io.onload = this._.handle.load);
		},	
		open: function(method, url/*, async*/){
			this._.openCfg = {
				method: method.toUpperCase() === 'GET' ? 'GET' : 'POST',
				action: url
			};
		},
		send: function(data, charset){
			var _this = this;
			setTimeout(function(){
				var ie67 = FOCUS.util.browser.msie && (FOCUS.util.browser.version == 6 || FOCUS.util.browser.version == 7);

				var formCfg = {
					el: 'form',
					name: 'FOCUS_UPLOAD_FORM_' + FOCUS.util.random(0, 1000),
					method: _this._.openCfg.method,
					/*enctype: 'multipart/form-data',*/
					action: _this._.openCfg.action || ''
				};
				
				//if(ie67){
					formCfg.target = _this.elems.io.name;
				//}
				
				var dataArray = [];
				var hasFile = false;
				var tmpElem;
				for(var key in data.elems){
					tmpElem = data.elems[key];
					if(tmpElem.type === 'file'){
						hasFile = true;
					}
					
					dataArray.push(tmpElem);
				}
				
				formCfg.enctype = hasFile ? 'multipart/form-data' : 'application/x-www-form-urlencoded';
				
				_this._deleteForm();
				var form = _this.elems.__submit_form = createElem(formCfg);
				form.style.cssText = 'position:absolute; width:1px; height:1px; top: -9999px; left:-9999px;';
				
				var doc = document;//ie67 ? document : _this.elems.doc;
				doc.body.appendChild(form);
				
				while(dataArray.length){
					form.appendChild(dataArray.shift());
				}
				
				charset = charset || _this.cfg.charset || 'UTF-8';
				//<-- [fixed] charset setting will lead form submit with other charset in ie
				//record the original document charset
				var originalCharset;
				FOCUS.util.browser.msie && (originalCharset = doc.charset);
				//-->
				FOCUS.util.browser.msie
					? (doc.charset = charset)
					: (form.acceptCharset = charset);
				
				/*_this._.timer = setTimeout(function(){
					_this._.handle.error.call(_this);
				}, _this.cfg.timeout);*/
				
				setTimeout(function(){
					_this._.submited = true;
					form.submit();
					
					//restore charset
					setTimeout(function(){ //make sure submit action executed
						FOCUS.util.browser.msie && (doc.charset = originalCharset);
					}, 1);
				}, 25);
			}, 100);
		},
		onload: function(fn){
			//this.event.bind('load', function(){});
			this.cfg.events.load = fn;
		},
		onerror: function(fn){
			this.cfg.events.error = fn;
		},
		overrideGetData: function(fn){
			this._.handle.getData = fn;
		},
		setUrl: function(url){
			this.elems.__submit_form.action = url;
		},
		_deleteForm: function(){
			try{
				if(this.elems.__submit_form){
					this.elems.__submit_form.parentNode.removeChild(this.elems.__submit_form);
				}
			}catch(ex){}
			
			delete this.elems.__submit_form;
		},
		_deleteIO: function(){
			try{
				if(this.elems.io){
					this.__removeOnloadEvent();
					this.elems.io.parentNode.removeChild(this.elems.io);
				}
			}catch(ex){}
			
			delete this.elems.doc;
			delete this.elems.win;
			delete this.elems.io;
		},
		dispose: function(){
			this._deleteForm();
			this._deleteIO();
		},
		__removeOnloadEvent: function(){
			if(this.elems.io){
				this.elems.io.detachEvent
					? this.elems.io.detachEvent('onload', this._.handle.load)
					: this.elems.io.onload = noop;
			}
		}
	};
	
	//
	io.IO_Iframe = IO_Iframe;
}.call(this, window, document);
;void function(window, document, undefined){
	var io = FOCUS.namespace('FOCUS.widget.io.iframe');
	var IO_FormData = io.IO_FormData;
	var IO_Iframe = io.IO_Iframe;
	var noop = function(){};

	//poster
	var Poster = function(cfg){
		this.cfg = {
			events: {
				//abort: noop,
				error: noop,
				load: noop,
				progress: noop,
				abort: noop
			},
			progressURL: '',
			charset: 'UTF-8',
			timeout: 100000
		};
		this._ = {
			cancel: false,
			timeout: false,
			loaded: false,
			timeoutTimer: -1
		};
		this.elems = {};		
		this.set(cfg);
		
		this.init();
	};
	Poster.prototype = {
		init: function(){
			var _this = this;
			this._.getProgress = function(){
				var me = arguments.callee;

				if(_this.cfg.progressURL && !_this._.loaded){
					_this.elems.io_progress = new IO_Iframe;
					//getData result: {loaded: xx, total: xx}
					_this.elems.io_progress.onload(function(data){
						setTimeout(function(){
							_this.elems.io_progress.dispose();
						}, 25);
						if(!_this._.loaded){
							data = FOCUS.util.JSON.parse(data);
							_this.cfg.events.progress.call(data);
							
							setTimeout(function(){
								me();
							}, 100);
						}
					});
					
					_this.elems.io_progress.open('GET', _this.cfg.progressURL, true);
					var data = new IO_FormData();
					data.append('progress', 'loaded');
					_this.elems.io_progress.send(data);
				}
			};
		},
		send: function(data){
			/*var formData = new IO_FormData;
			
			if(data){
				var type = FOCUS.util.type(data);
				var name;
				
				if(type === 'object'){
					for(var key in data){
						name = 'FOCUS_DATA_' + key + FOCUS.util.random(0, 1000);
						formData.append(name, data[key]);
					}
				}else{
					name = 'FOCUS_DATA_' + FOCUS.util.random(0, 1000);
					formData.append(name, data);
				}
			}*/
			
			var _this = this;
			this._.timeoutTimer = setTimeout(function(){ //timeout trigger
				_this.timeout();
			}, this.cfg.timeout);
			
			this.elems.io.send(data, this.cfg.charset);
			setTimeout(function(){//adjust the progress event trigger timing
				if(!_this._.cancel){
					_this.cfg.events.progress.call(_this, {loaded: 0, total: 100});
				}
			}, 1);

			this._.getProgress();
		},
		open: function(method, url/*, async*/){
			this._.fullProgress = false;
			this.reset();
			this.elems.io.open(method, url/*, async*/);
		},
		set: function(cfg){
			FOCUS.util.extend(true, this.cfg, cfg);
		},
		reset: function(){
			var _this = this;
			
			if(this.elems.io){
				this.elems.io.dispose();
			}
			
			if(this.elems.io_progress){
				this.elems.io_progress.dispose();
			}
			
			this.elems.io = new IO_Iframe({timeout: this.cfg.timeout});
			
			this.elems.io.onload(function(data){
				if(_this._.timeout){
					return;
				}
				
				if(!_this._.fullProgress){
					_this.cfg.events.progress.call(_this, {loaded: 100, total: 100});
					_this._.fullProgress = true;
				}
				
				clearTimeout(_this._.timeoutTimer);
				
				if(!_this._.cancel){ // not canceled
					_this._.loaded = true;
					_this.cfg.events.load.call(_this, data, this);
				}else{
					//_this.cfg.events.error.call(_this, data, this);
				}
			});
			
			this.elems.io.onerror(function(msg){
				clearTimeout(_this._.timeoutTimer);
				if(!_this._.cancel){ // not canceled
					_this.cfg.events.error.call(_this, this, msg);
				}else{
					//TODO
				}
			});
			
			this._.cancel =  false;
			this._.timeout = false;
			this._.loaded = false;
			this._.timeoutTimer = -1;
		},
		dispose: function(){
			if(this.elems.io){
				this.elems.io.dispose();
				delete this.elems.io;
			}
			
			if(this.elems.io_progress){
				this.elems.io_progress.dispose();
				delete this.elems.io_progress;
			}

			//TODO
		},
		timeout: function(){
			this._.timeout = true;
			this.elems.io.__removeOnloadEvent();
			this.cfg.events.error.call(this, this, 'timeout');
		},
		abort: function(){
			this._.cancel = true;
			clearTimeout(this._.timeoutTimer);
			this.elems.io && this.elems.io.__removeOnloadEvent();
			
			this.cfg.events.abort();
		}
	};
	
	//
	io.Poster = Poster;
}.call(this, window, document);
;void function(window, document, undefined){
	var createElem = FOCUS.util.createElement;
	var Poster = FOCUS.widget.io.iframe.Poster;
	var IO_FormData = FOCUS.widget.io.iframe.IO_FormData;
	var noop = function(){};

	///////
	FOCUS.widget.Upload_Iframe = function(cfg){
		this.constructor = arguments.callee;
		this.mode = FOCUS.widget.Upload.MODE.IFRAME;
		
		this.elems = {};
		this.cfg = {
			//priority: FOCUS.widget.Upload.PRIORITY.DEFAULT,
			events: {
				ready: noop,
				loadFailed: noop,
				dialogStart: noop,
				dialogComplete: noop,
				queued: noop,
				queueError: noop,
				uploadStart: noop,
				uploadProgress: noop,
				uploadSuccess: noop,
				uploadError: noop,
				uploadComplete: noop
			},
			button: {
				text: 'Upload'
			},
			// single or multi file(s) selection dialog
			// except: some browser such as ie6-9 not support multiple on input:file
			multiple: true,
			sizeLimit: -1,
			queueLimit: -1,
			fileTypes: FOCUS.widget.Upload.MIME_TYPE.ALL,
			fileTypesDescription: 'All Files',
			uploadURL: '',
			filePostName: '',
			placeholder: '',
			charset: FOCUS.widget.Upload.CHARSET.DEFAULT,
			debug: false,
			timeout: 100000
		};
		
		this._ = {
			queue: [],
			uploadingFile: null,
			uploadedFile: [],
			status: FOCUS.widget.Upload.TURNING.ON
		};
	
		this.set(cfg);
		this.init();
	};
	
	FOCUS.widget.Upload_Iframe.prototype = new FOCUS.widget.UploadBase();
	FOCUS.util.extend(true, FOCUS.widget.Upload_Iframe.prototype, {
		init: function(){
			var _this = this;

			/*this.elems.resetForm = createElem({
				el: 'form',
				name: 'FOCUS_UPLOAD_RESET_' + FOCUS.util.random(0, 1000)
			});*/
			
			this.elems.holder = createElem({
				el: 'div'
			});
			this.elems.holder.style.cssText = '';
			
			//validate errors
			var validate_errors = {
				missing_url: [FOCUS.widget.Upload.UPLOAD_ERROR.MISSING_UPLOAD_URL, 'missing upload URL.'],
				invalid_filetype: [FOCUS.widget.Upload.QUEUE_ERROR.INVALID_FILETYPE, 'File is not an allowed file type.'],
				size_limit: [FOCUS.widget.Upload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT, 'File size exceeds allowed limit.'],
				chain_error: [FOCUS.widget.Upload.QUEUE_ERROR.CHAIN_ERROR, 'Some reason to occured chain error.']
			};

			//events
			FOCUS.util.extend(this._, {
				post: function(file){
					var data = new IO_FormData;
					if(FOCUS.util.type(_this.cfg.postParams) === 'object'){
						for(var key in _this.cfg.postParams){
							data.append(key, _this.cfg.postParams[key]);
						}
					}
					
					data.append(_this.cfg.filePostName || file.id, file.data);
					
					_this.elems.poster.open('POST', _this.cfg.uploadURL, true);
					
					//setTimeout(function(){
						_this.elems.poster.send(data);
					//}, 1);
				},
				start: function(e){
					var file = _this.getQueueFile();
					if(file){
						if(!_this.cfg.uploadURL || FOCUS.util.type(_this.cfg.uploadURL) !== 'string'){
							_this.cfg.events.uploadError.apply(_this, [file].concat(validate_errors['missing_url']));
							
							_this.stopUpload();
							return;
						}
						
						file.status = FOCUS.widget.Upload.FILE_STATUS.IN_PROGRESS;
						_this._.uploadingFile = file;
						_this.cfg.events.uploadStart.call(_this, file);
						_this._.post(file);
					}
				},
				dialogStart: function(e){
					e = e || window.event;
					e.stopPropagation ? e.stopPropagation() : e.cancelBubble = true;
					//e.preventDefault ? e.preventDefault() : e.returnValue = false;
					
					_this.cfg.events.dialogStart.call(_this);
				},
				__queued: function(isFromDialog, callback){
					// this: input:file element
					var selected = [], queued = [], total = _this._.queue;
					
					var file = new FOCUS.widget.Upload.File(this);
					
					if(this.files && (!FOCUS.util.browser.firefox || (FOCUS.util.browser.firefox && FOCUS.util.browser.version >= 3.6))){ // support html5 files object
						var tmpQueued = [];
						var errorFlag = false;
						var file2valid;
						
						//exceed queue limit
						if(_this.cfg.queueLimit !== -1 && (this.files.length + _this._.queue.length) > _this.cfg.queueLimit){
							for(var i = 0, len = this.files.length; i < len; i++){
								file2valid = new FOCUS.widget.Upload.File(this.files[i]);
								selected.push(file2valid);
								
								_this.cfg.events.queueError.call(_this, file2valid, FOCUS.widget.Upload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED, _this.cfg.queueLimit);
							}
							
							errorFlag = true;
						}else{
							var sizeLimit = FOCUS.util.sizeConvert.unit2Bytes(_this.cfg.sizeLimit);
							
							// validate
							for(var i = 0, len = this.files.length; i < len; i++){
								file2valid = new FOCUS.widget.Upload.File(this.files[i]);
								selected.push(file2valid);

								var error;
								//filetype
								if(!FOCUS.util.mimeValidation(_this.cfg.fileTypes, file2valid.type)){
									error = validate_errors['invalid_filetype'];
								}else if(_this.cfg.sizeLimit !== -1 && (file2valid.fileSize || file2valid.size) > sizeLimit){ //filesize
									error = validate_errors['size_limit'];
								}
								
								if(!error){
									tmpQueued.push(file2valid);
								}else{
									_this.cfg.events.queueError.apply(_this, [file2valid].concat(error));
									errorFlag = true;
								}
							}
						}
						
						if(errorFlag){
							for(var i = 0, len = tmpQueued.length; i < len; i++){
								tmpQueued[i].id = file.id;
								_this.cfg.events.queueError.apply(_this, [tmpQueued[i]].concat(validate_errors['chain_error']));
							}
						}else{
							for(var i = 0, len = tmpQueued.length; i < len; i++){
								tmpQueued[i].status = FOCUS.widget.Upload.FILE_STATUS.QUEUED;
								tmpQueued[i].id = file.id;
								_this.cfg.events.queued.call(_this, tmpQueued[i]);
							}
							
							queued = queued.concat(tmpQueued);
							total.push(file);
						}
						
						delete tmpQueued;
					}else{ // normal input:file -- html4
						selected.push(file);
						
						if(FOCUS.util.mimeValidation(_this.cfg.fileTypes, file.type)){
							queued.push(file);
							total.push(file);
							file.status = FOCUS.widget.Upload.FILE_STATUS.QUEUED;
							_this.cfg.events.queued.call(_this, file);
						}else{
							_this.cfg.events.queueError.apply(_this, [file].concat(validate_errors['invalid_filetype']));
						}
					}

					if(isFromDialog){
						_this.elems.selector.parentNode.removeChild(_this.elems.selector);
						_this.elems.selector = _this._._crateSelector(_this.elems.holder, _this._.dialogStart, _this._.dialogComplete);
						
						//_this.elems.resetForm.reset();
						// total.length: total means all in queue, but in iframe method upload, only 1 append to total in one selected file
						//_this.cfg.events.dialogComplete.call(_this, selected.length, queued.length, total.length);
					}
					
					//excute callback
					if(FOCUS.util.type(callback) === 'function'){
						callback.call(_this, selected.length, queued.length, total.length);
					}
					
					delete selected;
					delete queued;
					delete total;
				},
				dialogComplete: function(e){
					e = e || window.event;
					e.stopPropagation ? e.stopPropagation() : e.cancelBubble = true;
					
					_this._.__queued.call(this, true, _this.cfg.events.dialogComplete);
				},
				uploadProgress: function(e){
					var file = _this.getQueueFile();
					file.status = FOCUS.widget.Upload.FILE_STATUS.IN_PROGRESS;
					if(e.loaded === e.total){ //markup the 100 percent in uploading
						file.fullProgress = true;
					}
					
					_this.cfg.events.uploadProgress.call(_this, file, e.loaded, e.total);
				},
				uploadSuccess: function(data, context){
					var poster = _this.elems.poster;
					var file = _this.getQueueFile();
					_this.cfg.events.uploadSuccess.call(_this, file, data, poster);
				},
				uploadError: function(context, msg){
					msg = (msg || '').toUpperCase();
					
					var file = _this.getQueueFile();
					file.status = FOCUS.widget.Upload.FILE_STATUS.ERROR;
					_this.cfg.events.uploadError.call(_this, file, FOCUS.widget.Upload.UPLOAD_ERROR[msg ? msg : 'UPLOAD_FAILED'], msg ? msg : 'TIMEOUT');
					
					_this._.uploadComplete(true);
				},
				uploadComplete: function(fail, isStop){
					var file = _this.getQueueFile();
				
					if(!fail && !file.fullProgress && !isStop){
						_this._.uploadProgress.call(_this, { loaded: file.size, total: file.size });
						file.fullProgress = true;
					}
					
					if(!isStop){
						file.status = FOCUS.widget.Upload.FILE_STATUS.COMPLETE;
					}
					
					_this._.queue.shift();
					_this._.uploadingFile = null;
					
					_this.cfg.events.uploadComplete.call(_this, file);
					
					//if(!isStop){
						//_this._.start();
					//}
				},
				complete: function(data, context){
					_this._.uploadSuccess.call(_this, data, context);
					_this._.uploadComplete.call(_this);
					
					//In IE, no dispose, it will refuse access iframe when F5 refresh
					setTimeout(function(){
						//for firefox, at this the iframe loaded time,
						//there is a loading progress bar always in firefox that destroy the iframe straightway.
						//use timer to restore it
						if(_this.elems.poster){
							_this.elems.poster.dispose();
							delete _this.elems.poster;
						}
					}, 25);
				},
				abort: function(){
					_this._.uploadComplete(false, true);
				},
				_crateSelector: function(wrap, dialogStart, dialogComplete){
					var selector = createElem({
						el: 'input',
						type: 'file',
						name: 'FOCUS_FILE_' + FOCUS.util.random(0, 100),
						//'class': FOCUS.widget.Upload.CSS.SELECTOR,
						multiple: !!_this.cfg.multiple//,
						//accept: FOCUS.util.browser.chrome ? '*/*' : _this.cfg.fileTypes
					});
					
					wrap.appendChild(selector);
					FOCUS.util.event.bind(selector, 'click', dialogStart);
					FOCUS.util.event.bind(selector, 'change', dialogComplete);
					
					_this.__setStyle('iframe', _this.elems.holder, selector, _this.cfg.button.text);
					
					return selector;
				}
			});
			
			
			//holder
			var place = FOCUS.query
				? FOCUS.query(this.cfg.placeholder)
				: document.getElementById(this.cfg.placeholder.replace(/^#/, ''));
				
			if(place){
				if('length' in place){
					place = place[0];
				}
				
				if(place){
					place.parentNode.insertBefore(this.elems.holder, place);
					//this.elems.holder.appendChild(this.elems.resetForm);
					_this.elems.selector = this._._crateSelector(this.elems.holder, this._.dialogStart, this._.dialogComplete);
					place.parentNode.removeChild(place);
				}
			}
		},
		startUpload: function(){
			if(this.elems.poster){
				this.elems.poster.dispose();
			}
			
			this.elems.poster = new Poster({
				events: {
					abort: this._.abort,
					load: this._.complete,
					error: this._.uploadError,
					progress: this._.uploadProgress
				},
				progressURL: this.cfg.progressURL,
				charset: this.cfg.charset,
				timeout: this.cfg.timeout || 100000
			});
			
			this._.start();
		},
		/**
		* queue files
		* @param {FileInput|FileInput[]} files
		* @param {Function} [callback] queue completed callback
		*/
		queue: function(files, callback){
			if(!files){
				return;
			}
			
			if(files.length === undefined){
				files = [files];
			}
			
			for(var i = 0; i < files.length; i++){
				this._.__queued.call(files[i], false, callback);
			}
		}
	});
}.call(this, this, this.document);

/**
* Known Problems
* 1 in chrome, if cross domain, try...catch.. could not catch the 'unsafe error' tip on access iframe.contentWindow in 'getData' method calling with IO_Iframe object
*/







































